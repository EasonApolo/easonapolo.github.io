var xt=Object.defineProperty,Bt=Object.defineProperties;var bt=Object.getOwnPropertyDescriptors;var dt=Object.getOwnPropertySymbols;var Pt=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable;var _t=(t,e,s)=>e in t?xt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,pt=(t,e)=>{for(var s in e||(e={}))Pt.call(e,s)&&_t(t,s,e[s]);if(dt)for(var s of dt(e))Tt.call(e,s)&&_t(t,s,e[s]);return t},gt=(t,e)=>Bt(t,bt(e));import{d as S,r as ft,o as u,c as d,a as l,b as _,w as c,e as f,p as H,f as G,g as W,s as R,u as r,h as w,n as it,t as h,i as O,j as At,T as vt,K as Ot,F as P,k as Lt,l as z,m as rt,q as Rt,v as Ut,x as q,y as N,z as V,A as K,B as lt,C as mt,D as Mt,E as yt,G as Nt,H as Vt,I as Kt,J as Wt}from"./vendor.64d9c635.js";const jt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}};jt();var x=(t,e)=>{const s=t.__vccOpts||t;for(const[o,i]of e)s[o]=i;return s};const $t=t=>(H("data-v-77e0ea43"),t=t(),G(),t),Ht={class:"nav"},Gt={class:"nav-item"},Jt=f("\u6587\u5B57"),zt={class:"nav-item"},qt=f("\u53D1\u8A00"),Yt={class:"nav-item pg"},Qt=$t(()=>l("div",null,"play",-1)),Xt=$t(()=>l("div",null,"ground",-1)),Zt={class:"nav-item"},te=f("\u4E2A\u4EBA"),ee=S({setup(t){return(e,s)=>{const o=ft("router-link");return u(),d("div",Ht,[l("div",Gt,[_(o,{to:"/"},{default:c(()=>[Jt]),_:1})]),l("div",zt,[_(o,{to:"/message"},{default:c(()=>[qt]),_:1})]),l("div",Yt,[_(o,{to:"/playground"},{default:c(()=>[Qt,Xt]),_:1})]),l("div",Zt,[_(o,{to:"/profile"},{default:c(()=>[te]),_:1})])])}}});var se=x(ee,[["__scopeId","data-v-77e0ea43"]]);const oe=2e3,ne={"?":"https://pt-starimg.didistatic.com/static/starimg/img/KY7KIe3Q4q1639999226185.png","!":"https://pt-starimg.didistatic.com/static/starimg/img/jGg8Oue4V41639999416168.png",OK:"https://pt-starimg.didistatic.com/static/starimg/img/iHBDA1efzF1637660245957.png",ERR:"https://pt-starimg.didistatic.com/static/starimg/img/lbgKE9Icl91639038730163.png",LOADING:""},J=W("toast",{state:()=>({show:!1,type:"",icon:"",content:"",timer:0}),actions:{showToast({content:t,type:e,timeout:s=oe}){!t||(this.show&&clearTimeout(this.timer),this.content=t,this.type=e,this.icon=ne[e],this.show=!0,this.timer=setTimeout(this.clear,s))},clear(){this.show=!1,this.content=""}}});const ae=t=>(H("data-v-76d25ff2"),t=t(),G(),t),ie={viewBox:"0 0 50 50",class:"loading-svg"},re=ae(()=>l("circle",{cx:"25",cy:"25",r:"20",fill:"none",class:"path"},null,-1)),le=[re],ue=S({setup(t){return(e,s)=>(u(),d("svg",ie,le))}});var ce=x(ue,[["__scopeId","data-v-76d25ff2"]]);const de={key:0,class:"toast-wrapper"},_e={class:"toast"},pe={class:"content"},ge=S({setup(t){const e=J(),{type:s,show:o,content:i,icon:a}=R(e);return(n,p)=>r(o)?(u(),d("div",de,[l("div",_e,[r(s)==="loading"?(u(),w(ce,{key:0})):(u(),d("div",{key:1,class:"icon",style:it({"background-image":`url(${r(a)})`})},null,4)),l("div",pe,h(r(i)),1)])])):O("",!0)}});var he=x(ge,[["__scopeId","data-v-0bfefd2e"]]);const fe=location.href.includes("forvera.me")?"online":"local",st=fe==="online"?"http://106.54.172.20:3000/":`http://${location.hostname}:3000/`;async function b(t,e="get",s,o){let i={url:t,baseURL:st,withCredentials:!0,headers:{},method:e};const a=X(),n=a.userInfo.token;if(n&&(i.headers.Authorization=n),s)if(typeof s=="string")i.data=s,i.headers["Content-Type"]="application/json";else if(s instanceof FormData)i.data=s;else{let p=new FormData;for(let v in s)p.append(v,s[v]);i.data=p}try{return(await At(i)).data}catch(p){const v=J();if(p.message==="Network Error")return v.showToast({content:"\u7F51\u7EDC\u9519\u8BEF\uFF0C\u53EF\u80FD\u662F\u540E\u53F0\u6302\u4E86\uFF5E",type:"!",timeout:3e3}),{ERRNO:500};const T=p.response.status;return T===401&&(a.isLogin&&v.showToast({content:"\u767B\u5F55\u51ED\u8BC1\u5DF2\u8FC7\u671F\uFF0C\u8BF7\u4FDD\u5B58\u540E\u70B9\u51FB\u4E2A\u4EBA\u91CD\u65B0\u767B\u5F55\u3002",type:"!",timeout:3e3}),a.logout()),{ERRNO:T}}}const X=W("user",{state:()=>({loginData:{username:"",password:""},userInfo:{username:void 0,token:void 0}}),getters:{isLogin:t=>!!t.userInfo.token},actions:{async getUserInfo(){let t=localStorage.token;if(t){t=`Bearer ${t}`,Object.assign(this.userInfo,{token:t});const e=await b("user/info","POST");if(e&&!(e==null?void 0:e.ERRNO)){const{username:s}=e;s&&(localStorage.username=s,Object.assign(this.userInfo,{username:s}))}else Object.assign(this.userInfo,{token:void 0}),e.ERRNO==401&&J().showToast({content:"\u767B\u5F55\u4FE1\u606F\u5DF2\u5931\u6548\uFF0C\u53EF\u4EE5\u91CD\u65B0\u767B\u5F55\uFF5E",type:"?"})}},async login(){let t,e;if(localStorage.token&&localStorage.username&&(t=localStorage.token,e=localStorage.username),!(t&&e)){const s=this.loginData;if(!(s.username&&s.password))return;t=(await b("auth/login","POST",JSON.stringify(s))).token,e=this.loginData.username}t&&e&&(localStorage.token=t,localStorage.username=e,t=`Bearer ${t}`,Object.assign(this.userInfo,{token:t,username:e}))},async logout(){delete localStorage.token,delete localStorage.username,Object.assign(this.userInfo,{token:void 0,username:void 0})},validateLoginForm(){var t;return!(((t=this.loginData.username)==null?void 0:t.length)<3||this.loginData.password.length<3)},async register(){if(!this.validateLoginForm())return!1;let t=this.loginData;const{token:e,ERRNO:s}=await b("auth/register","POST",JSON.stringify(t));s||Object.assign(this.userInfo,{token:e,username:this.loginData.username})}}}),wt=W("image",{state:()=>({url:""}),getters:{show:t=>!!t.url},actions:{preview(t){t=t.replace("_thumb",""),this.url=t},stopPreview(){this.url=""}}});const ve=t=>(H("data-v-5881608e"),t=t(),G(),t),me=ve(()=>l("div",{class:"bg"},null,-1)),ye=["src"],$e=S({setup(t){const e=wt(),s=()=>{e.stopPreview()};return(o,i)=>(u(),w(vt,{name:"fade"},{default:c(()=>[r(e).show?(u(),d("div",{key:0,class:"image-preview",onClick:s},[me,l("img",{class:"image",src:r(e).url},null,8,ye)])):O("",!0)]),_:1}))}});var we=x($e,[["__scopeId","data-v-5881608e"]]);const Fe=S({setup(t){return X().getUserInfo(),(s,o)=>{const i=ft("router-view");return u(),d(P,null,[(u(),w(Ot,{exclude:"profile"},[_(i)],1024)),_(vt,{name:"toast-slide"},{default:c(()=>[_(he,{class:"toast"})]),_:1}),_(se),_(we)],64)}}});const Ce={class:"card"},ke={key:0,class:"title"},Se=S({setup(t){const s=Lt().title;return(o,i)=>(u(),d("div",Ce,[r(s)?(u(),d("div",ke,[z(o.$slots,"title",{},void 0,!0)])):O("",!0),z(o.$slots,"default",{},void 0,!0)]))}});var I=x(Se,[["__scopeId","data-v-80441538"]]);const Ee=t=>(H("data-v-fb7a8a88"),t=t(),G(),t),De={key:0},Ie=Ee(()=>l("svg",{viewBox:"0 0 50 50",class:"loading-svg"},[l("circle",{cx:"25",cy:"25",r:"20",fill:"none",class:"path"})],-1)),xe=[Ie],Be={key:1},be=S({props:{type:null,loading:{type:Boolean}},setup(t){return(e,s)=>(u(),d("div",{class:rt(["button",{primary:t.type=="primary"}])},[t.loading?(u(),d("div",De,xe)):(u(),d("div",Be,[z(e.$slots,"default",{},void 0,!0)]))],2))}});var A=x(be,[["__scopeId","data-v-fb7a8a88"]]);const Z=W("category",{state:()=>({categories:[],editing:{},categoryMap:{}}),actions:{init(){this.categories.length||this.fetchCategories()},async fetchCategories(){this.categories=await b("cat"),this.categories.forEach(t=>this.categoryMap[t._id]=t)},checkParam(){return this.editing.title&&this.editing.description},clear(){this.editing={}},async add(){!this.checkParam()||await b("cat","POST",JSON.stringify(this.editing))},async update(){!this.checkParam()||!this.editing._id||await b(`cat/${this.editing._id}`,"PUT",JSON.stringify(this.editing))},async delete(){!this.editing._id||(await b(`cat/${this.editing._id}`,"DELETE"),this.clear())},mapCategoryName(t){return t.map(e=>this.categoryMap[e].title)}}}),tt=W("main",{state:()=>({posts:[],route:Rt(),router:Ut()}),actions:{async init(){Z().fetchCategories()},async go(t){this.router.push(t)}}}),j=W("post",{state:()=>({posts:[],myPosts:[]}),actions:{async fetchPostById(t){return await b(`post/${t}`,"GET")},async createPost(){return await b("post","POST")},async fetchPosts(){this.posts=await b("post")},async fetchMyPosts(){this.myPosts=await b("post/user","POST")},async updatePost(t,e){return await b(`post/${t}`,"PUT",JSON.stringify(e))},async uploadSingleImage(t,e){return await b(`file/uploadSingle/${t}`,"POST",{file:e})},async fetchImagesOfPost(t){return await b(`file/post/${t}`,"POST")},async deletePost(t){return await b(`post/${t}`,"DELETE")}}}),Q=t=>{const e=new Date(t);return`${e.getFullYear()}-${et(e.getMonth()+1)}-${et(e.getDate())} ${et(e.getHours())}:${et(e.getMinutes())}`},et=t=>t<10?`0${t}`:`${t}`,Ft=t=>new Promise(e=>{const s=new FileReader;s.onload=o=>e({blob:o.target.result,file:t}),s.readAsDataURL(t)}),Pe=t=>{let e=null;return(...s)=>{e||(t(...s),e=setTimeout(()=>{e=null},1e3))}};function Ct(t,e=!1){const s=o=>`${st}${e?o.thumb:o.url}`;return Array.isArray(t)?t.map(s):s(t)}const kt=W("write",{state:()=>({postId:"",post:{},files:[]}),getters:{images:t=>Ct(t.files)},actions:{async init(t){const e=j();t?this.post=await e.fetchPostById(t):this.post=await e.createPost(),this.postId=t||this.post._id},changeStatus(){this.post.status===1?this.post.status=0:this.post.status===0&&(this.post.status=1)},async publish(){if(this.post.title.length<1&&this.post.content.length<1)return;let t=gt(pt({},this.post),{time:Date.now()});return await j().updatePost(this.postId,t)},async deletePost(){return await j().deletePost(this.postId)},toggleCategory(t){Array.isArray(this.post.category)?this.post.category.includes(t)?this.post.category.splice(this.post.category.indexOf(t),1):this.post.category.push(t):this.post.category=[t]},async uploadImage(t){await j().uploadSingleImage(this.postId,t),this.initUploadedImages()},async initUploadedImages(){const t=j();this.files=await t.fetchImagesOfPost(this.postId)}}});const Te={class:"flex-center"},Ae=f("\u767B\u5F55"),Oe=f("\u6CE8\u518C"),Le=f("\u767B\u51FA"),Re={class:"actions"},Ue=f("\u5199\u6587\u7AE0"),Me=f("\u7F16\u8F91\u5206\u7C7B"),Ne={class:"my-posts"},Ve={class:"post-info"},Ke={class:"title"},We={class:"desc"},je={key:0,class:"status"},He={class:"post-actions"},Ge=f("\u4FEE\u6539"),Je=S({setup(t){const[e,s,o,i,a]=[X(),tt(),j(),kt(),J()],{loginData:n,isLogin:p,userInfo:v}=R(e),{myPosts:T}=R(o);e.login(),e.isLogin&&o.fetchMyPosts();const B=async()=>{await e.login(),e.isLogin?(a.showToast({content:"\u767B\u5F55\u6210\u529F\uFF5E",type:"OK"}),o.fetchMyPosts()):a.showToast({content:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF5E",type:"ERR"})},U=async()=>{if(!await e.register()){console.log("fail");return}o.fetchMyPosts()},k=async()=>{e.logout(),a.showToast({content:"\u5DF2\u767B\u51FA\uFF5E",type:"OK"})},F=q({write:!1,login:!1,register:!1}),$=()=>{s.router.push("write")},E=async()=>{F.value.write=!0,await i.init(),F.value.write=!1,$()},g=async m=>{await i.init(m),$()},y=()=>{s.router.push("category")};return(m,L)=>r(p)?(u(),d(P,{key:1},[_(I,{class:"item user-info-bar"},{default:c(()=>[l("div",null,h(r(v).username),1),_(A,{onClick:k},{default:c(()=>[Le]),_:1})]),_:1}),_(I,{class:"item"},{default:c(()=>[l("div",Re,[_(A,{onClick:E,loading:F.value.write},{default:c(()=>[Ue]),_:1},8,["loading"]),_(A,{onClick:y},{default:c(()=>[Me]),_:1})])]),_:1}),l("div",Ne,[(u(!0),d(P,null,N(r(T),C=>(u(),w(I,{class:rt(["item post",{hidden:C.status!==1}])},{default:c(()=>[l("div",Ve,[l("span",Ke,h(C.title),1),l("span",We,h(r(Q)(C.updated_time)),1),C.status!==1?(u(),d("div",je,"\u9690\u85CF")):O("",!0)]),l("div",He,[_(A,{onClick:D=>g(C._id)},{default:c(()=>[Ge]),_:2},1032,["onClick"])])]),_:2},1032,["class"]))),256))])],64)):(u(),w(I,{key:0,class:"login-wrapper"},{default:c(()=>[V(l("input",{class:"text-input","onUpdate:modelValue":L[0]||(L[0]=C=>r(n).username=C)},null,512),[[K,r(n).username]]),V(l("input",{class:"text-input","onUpdate:modelValue":L[1]||(L[1]=C=>r(n).password=C),type:"password"},null,512),[[K,r(n).password]]),l("div",Te,[_(A,{type:"primary",onClick:B,loading:F.value.login},{default:c(()=>[Ae]),_:1},8,["loading"]),_(A,{onClick:U,loading:F.value.register},{default:c(()=>[Oe]),_:1},8,["loading"])])]),_:1}))}});var ze=x(Je,[["__scopeId","data-v-14e1d331"]]);const St=W("message",{state:()=>({messages:[],messageInput:{content:"",files:[],parent:"",ancestor:"",progress:0},messageWrapper:{replyToUsername:"",anonymous:!0},page:0,loading:!1,anonymousNameList:[]}),actions:{reply(t){this.clearMessageInput(),t&&(this.messageInput.parent=t._id,this.messageInput.ancestor=t.level===0?t._id:t.ancestor,this.messageWrapper.replyToUsername=t.user.username)},clearMessageInput(){this.messageInput={content:"",files:[],parent:"",ancestor:"",progress:0},this.messageWrapper.replyToUsername=""},async fetchMessages(t=!1){if(t&&(this.page=0,this.messages=[]),this.loading)return;this.loading=!0;let e=await b(`twit/${this.page}`);return e.forEach(s=>{s.files.forEach(o=>{o.url=`${st}${o.url}`,o.thumb=`${st}${o.thumb}`})}),e.length>0&&(this.messages.push(...e),this.page++),this.loading=!1,e},async addMessage(){const{content:t,parent:e,ancestor:s,files:o}=this.messageInput,{anonymous:i}=this.messageWrapper,a=i?"twit/anonymous":"twit",n=new FormData;if(n.append("content",t),e&&s&&(n.append("parent",e),n.append("ancestor",s)),!i)for(let v of o)n.append("files",v);return await b(a,"POST",n,{upload:!0,progress:this.messageInput})}}});const qe={class:"gallery"},Ye=["onClick"],Qe=S({props:{images:null,onClick:null},setup(t){return(e,s)=>(u(),d("div",qe,[(u(!0),d(P,null,N(t.images,(o,i)=>(u(),d("div",{class:"item",style:it({backgroundImage:`url(${o})`}),onClick:lt(a=>{var n;return(n=t.onClick)==null?void 0:n.call(t,t.images,i)},["stop"])},null,12,Ye))),256))]))}});var Xe=x(Qe,[["__scopeId","data-v-36f53590"]]);const Ze={class:"header"},ts={class:"name"},es={class:"date"},ss={class:"content"},os={key:1,class:"reply-wrapper"},ns=["onClick"],as={class:"header"},is={class:"name"},rs={key:0,class:"name"},ls={class:"date"},us={class:"content"},cs=S({setup(t){const[e,s,o,i,a]=[St(),X(),tt(),J(),wt()],{messages:n,messageInput:p,messageWrapper:v}=R(e);R(s),e.fetchMessages(!0);const T=Pe(async()=>{let $=await e.fetchMessages();$&&$.length<=0&&i.showToast({content:"\u6CA1\u6709\u66F4\u591A\u5566",type:"!"})}),B=()=>{document.documentElement.scrollTop+window.innerHeight>=document.body.clientHeight-160&&T()};window.addEventListener("scroll",B),mt(()=>window.removeEventListener("scroll",B));const U=($,E)=>{let g;if(E.level===1){const y=$.descendants.find(m=>m._id===E.parent);y&&(g=y.user.username)}return g},k=($,E)=>{a.preview($[E])},F=$=>{e.reply($),o.router.push("addMessage")};return($,E)=>(u(),d(P,null,[(u(!0),d(P,null,N(r(n),g=>(u(),w(I,{class:"message",onClick:y=>F(g)},{default:c(()=>{var y;return[l("div",Ze,[l("div",ts,h(g.user.username),1),l("div",es,h(r(Q)(g.created_time)),1)]),l("div",ss,h(g.content),1),g.files.length?(u(),w(Xe,{key:0,class:"gallery",images:g.files.map(m=>m.thumb),onClick:k},null,8,["images"])):O("",!0),((y=g.descendants)==null?void 0:y.length)>0?(u(),d("div",os,[(u(!0),d(P,null,N(g.descendants,m=>(u(),d("div",{class:"reply",onClick:lt(L=>F(m),["stop"])},[l("div",as,[l("div",is,h(m.user.username),1),U(g,m)?(u(),d("div",rs,": "+h(U(g,m)),1)):O("",!0)]),l("div",ls,h(r(Q)(m.created_time)),1),l("div",us,h(m.content),1)],8,ns))),256))])):O("",!0)]}),_:2},1032,["onClick"]))),256)),l("div",{class:"send",onClick:E[0]||(E[0]=g=>F())})],64))}});var ds=x(cs,[["__scopeId","data-v-2f5ce8d4"]]);const _s=S({props:{active:{type:Boolean}},setup(t){return(e,s)=>(u(),d("div",{class:rt(["label",{active:t.active}])},[z(e.$slots,"default",{},void 0,!0)],2))}});var ot=x(_s,[["__scopeId","data-v-83f165e8"]]);const ps=f("\u9009\u62E9"),gs=["multiple"],hs=S({props:{change:null,multiple:{type:Boolean}},setup(t){const{change:e,multiple:s=!1}=t,o=q({}),i=()=>{o.value.click()},a=n=>{e(n.target)};return(n,p)=>(u(),d(P,null,[_(A,{onClick:i},{default:c(()=>[ps]),_:1}),l("input",{ref_key:"fileInput",ref:o,class:"input",type:"file",onChange:a,multiple:t.multiple},null,40,gs)],64))}});var Et=x(hs,[["__scopeId","data-v-3e84ab72"]]);const fs={class:"gallery-wrapper"},vs={class:"gallery"},ms=["onClick","onDragstart","onDragenter"],ys=S({props:{images:null,onClick:null,isDraggable:{type:Boolean},onDrag:null,onRemove:null},setup(t){const{isDraggable:e=!1,onDrag:s,onRemove:o}=t;let i,a,n=q(!1);const p=k=>{i=k,n.value=!0,console.log(n)},v=k=>{a=k,a!==void 0&&i!==void 0&&(s==null||s(a,i),i=a)},T=()=>{a===-1&&i!==void 0&&(o==null||o(i)),i=a=void 0,n.value=!1},B=()=>{a=-1},U=()=>{a=void 0};return(k,F)=>(u(),d("div",fs,[l("div",vs,[(u(!0),d(P,null,N(t.images,($,E)=>(u(),d("div",{class:"item",style:it({backgroundImage:`url(${$})`}),onClick:g=>{var y;return(y=t.onClick)==null?void 0:y.call(t,E)},draggable:"true",onDragstart:g=>p(E),onDragenter:g=>v(E),onDragend:F[0]||(F[0]=g=>T())},null,44,ms))),256))]),r(n)?(u(),d("div",{key:0,class:"remove",onDragenter:B,onDragleave:U,onDragover:F[1]||(F[1]=lt(()=>{},["prevent"]))},null,32)):O("",!0)]))}});var Dt=x(ys,[["__scopeId","data-v-3a7b9a81"]]);const nt=t=>(H("data-v-86a5fe5c"),t=t(),G(),t),$s={class:"content"},ws={class:"tips"},Fs=nt(()=>l("br",null,null,-1)),Cs=f(" - \u9000\u51FA\u9875\u9762\u4F1A\u6E05\u7A7A\uFF0C\u4E0D\u8981\u5728\u8FD9\u91CC\u6253\u4E00\u5806\u5B57\u54E6\u3002"),ks=nt(()=>l("br",null,null,-1)),Ss=nt(()=>l("br",null,null,-1)),Es={class:"actions"},Ds={class:"right"},Is=nt(()=>l("div",{class:"icon"},null,-1)),xs=S({props:{msg:null},setup(t){const[e,s,o,i]=[St(),X(),J(),tt()],{messageInput:a,messageWrapper:n}=R(e),{isLogin:p}=R(s),v=Mt([]),T=yt(()=>v.map(g=>g.blob)),B=async g=>{const y=g.files;if(y==null?void 0:y.length){const m=Array.from(y),L=await Promise.all(m.map(Ft));v.push(...L),e.messageInput.files=v.map(C=>C.file)}},U=(g,y)=>{const m=v.splice(y,1)[0];v.splice(g,0,m),e.messageInput.files=v.map(L=>L.file)},k=g=>{v.splice(g,1),e.messageInput.files=v.map(y=>y.file)},F=n.value.replyToUsername?`\u56DE\u590D${n.value.replyToUsername}`:"\u53D1\u9001",$=async()=>{if(!a.value.content.length){o.showToast({content:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",type:"ERR"});return}if(a.value.content.length<4){o.showToast({content:`\u5185\u5BB9\u5C11\u4E8E${a.value.content.length}\u4E2A\u5B57\u4E5F\u4E0D\u884C`,type:"ERR"});return}await e.addMessage(),o.showToast({content:"\u53D1\u9001\u6210\u529F\uFF5E",type:"OK"}),i.router.go(-1)},E=()=>{!p.value||e.$patch({messageWrapper:{anonymous:!n.value.anonymous}})};return(g,y)=>(u(),w(I,{class:"input-wrapper"},{default:c(()=>{var m;return[l("div",$s,[l("div",ws,[f(" - "+h(r(s).isLogin?"":"\u5F53\u524D\u672A\u767B\u5F55\uFF0C\u767B\u5F55\u540E")+"\u53EF\u4EE5"+h(r(n).replyToUsername?"":"\u9644\u5E26\u6700\u591A3\u5F20\u56FE\u7247\u548C")+"\u5207\u6362\u8EAB\u4EFD\u3002",1),Fs,Cs,ks,f(" - \u6B63\u5728\u4EE5"+h(r(n).anonymous?"\u968F\u673A":r(s).userInfo.username)+"\u8EAB\u4EFD"+h(r(n).replyToUsername?`\u56DE\u590D${r(n).replyToUsername}`:"\u53D1\u8A00")+"\u3002",1),Ss]),V(l("textarea",{class:"input text-input","onUpdate:modelValue":y[0]||(y[0]=L=>r(a).content=L),rows:"3"},null,512),[[K,r(a).content]]),!r(n).anonymous&&((m=r(T))==null?void 0:m.length)?(u(),w(Dt,{key:0,images:r(T),class:"gallery","is-draggable":!0,onDrag:U,onRemove:k},null,8,["images"])):O("",!0),l("div",Es,[_(A,{class:"action send",onClick:$},{default:c(()=>[f(h(r(F)),1)]),_:1}),l("div",Ds,[!r(n).anonymous&&!r(n).replyToUsername?(u(),w(Et,{key:0,change:B,multiple:!0})):O("",!0),_(ot,{class:"action",onClick:E,active:r(n).anonymous},{default:c(()=>[f(h(r(n).anonymous?"\u533F\u540D\u4E2D":"\u542F\u7528\u533F\u540D"),1)]),_:1},8,["active"])])])]),Is]}),_:1}))}});var Bs=x(xs,[["__scopeId","data-v-86a5fe5c"]]);const bs={},Ps={class:"layout-list"};function Ts(t,e){return u(),d(P,null,[z(t.$slots,"layout-title",{class:"title"}),l("div",Ps,[z(t.$slots,"content")])],64)}var Y=x(bs,[["render",Ts]]);const As=f("\u6807\u9898"),Os=f("\u63CF\u8FF0"),Ls=f("\u9009\u62E9\u6807\u7B7E"),Rs={class:"categories"},Us=f("\u56FE\u7247"),Ms={class:"image-input"},Ns=f("\u4E0A\u4F20"),Vs=["src"],Ks=f("\u63D0\u4EA4"),Ws=f("\u5220\u9664"),js=S({setup(t){const[e,s,o,i]=[kt(),Z(),J(),tt()],{post:a,images:n,files:p}=R(e),{categories:v}=R(s);e.initUploadedImages(),s.init();const T=C=>{var D;return(D=a.value.category)==null?void 0:D.includes(C)},B=e.toggleCategory,U=async()=>{await e.publish()&&(o.showToast({content:"\u5DF2\u66F4\u65B0",type:"OK"}),i.go("profile"))},k=async()=>{!confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F")||(await e.deletePost(),o.showToast({content:"\u5DF2\u5220\u9664\uFF5E",type:"OK"}),i.go("profile"))},F=()=>{e.changeStatus()};let $=q({});const E=async C=>{const D=C.files;(D==null?void 0:D.length)&&($.value=await Ft(D[0]))},g=async()=>{e.uploadImage($.value.file)},y=C=>{const D=Ct(p.value[C]);m.value=`<img src="${D}" width="auto">`},m=q(""),L=C=>{C.target.select(),document.execCommand("Copy"),o.showToast({content:"\u5DF2\u590D\u5236\u56FE\u7247\u4EE3\u7801\uFF0C\u8BF7\u7C98\u8D34\u5230\u6587\u7AE0\u4E2D\u3002",type:"OK"})};return(C,D)=>(u(),w(Y,null,{content:c(()=>[_(I,null,{title:c(()=>[As]),default:c(()=>[V(l("input",{class:"text-input","onUpdate:modelValue":D[0]||(D[0]=M=>r(a).title=M)},null,512),[[K,r(a).title]])]),_:1}),_(I,null,{title:c(()=>[Os]),default:c(()=>[V(l("input",{class:"text-input","onUpdate:modelValue":D[1]||(D[1]=M=>r(a).description=M)},null,512),[[K,r(a).description]])]),_:1}),_(I,null,{default:c(()=>[V(l("textarea",{class:"text-input textarea","onUpdate:modelValue":D[2]||(D[2]=M=>r(a).content=M)},null,512),[[K,r(a).content]])]),_:1}),_(I,null,{title:c(()=>[Ls]),default:c(()=>[l("div",Rs,[(u(!0),d(P,null,N(r(v),M=>(u(),w(ot,{active:T(M._id),onClick:Uo=>r(B)(M._id)},{default:c(()=>[f(h(M.title),1)]),_:2},1032,["active","onClick"]))),256))])]),_:1}),_(I,null,{title:c(()=>[Us]),default:c(()=>[l("div",Ms,[_(Et,{change:E,multiple:!1}),_(A,{class:"upload-btn",onClick:g},{default:c(()=>[Ns]),_:1}),l("img",{class:"preview",src:r($).blob},null,8,Vs)]),m.value?V((u(),d("textarea",{key:0,class:"copy-container text-input","onUpdate:modelValue":D[3]||(D[3]=M=>m.value=M),readonly:"",onClick:L,rows:"3"},null,512)),[[K,m.value]]):O("",!0),r(n).length>0?(u(),w(Dt,{key:1,images:r(n),onClick:y,class:"gallery"},null,8,["images"])):O("",!0)]),_:1}),_(I,{class:"actions"},{default:c(()=>[_(A,{onClick:U},{default:c(()=>[Ks]),_:1}),_(ot,{onClick:F,active:r(a).status===1},{default:c(()=>[f(h(r(a).status===1?"\u5DF2\u516C\u5F00":"\u5DF2\u9690\u85CF"),1)]),_:1},8,["active"]),_(A,{onClick:k},{default:c(()=>[Ws]),_:1})]),_:1})]),_:1}))}});var Hs=x(js,[["__scopeId","data-v-cdf4b154"]]);const Gs=t=>{let e=new Proxy({source:t,text:t,finished:!1,index:0,res:[]},{set:function(o,i,a,n){return i==="index"?(a>=Reflect.get(o,"source").length&&Reflect.set(o,"finished",!0),Reflect.set(o,"index",a)):Reflect.set(o,i,a)}}),s=0;for(;!e.finished&&s<10;)Ys(e)||qs(e)||(e.text.startsWith("```\n")?zs(e):Js(e)),console.log(e.index,e.finished,e.text,e.res.slice(-1)),s++;return e.res.join("")},ut=t=>{let e=t.text,s=e.indexOf(`
`),o=s>=0;s=o?s:e.length;const i=o?s+1:s;let a=e.slice(0,s);return a=a.replaceAll(/<img\s.+?>/g,n=>{const p=n.match(/description="(.+)"/);if(p){const v=`<span class="image-description">${p[1]}</span>`;return n+v}return n}),{content:a,next:i}},Js=t=>{let e=t.text;const{content:s,next:o}=ut(t);t.res.push(`<p>${s}</p>`),t.text=e.slice(o),t.index+=o},zs=t=>{let e=t.text,s=4;for(;s<e.length&&!(e[s]==="`"&&e.slice(s,s+3)==="```");)s++;const o=e.slice(4,s);t.res.push(`<code>${o}</code>`);const i=e.slice(s+3,s+4)===`
`?s+4:s+3;t.text=e.slice(i),t.index+=i},qs=t=>{let e=t.text,s=e.match(/^#+\s/);if(s==null?void 0:s.length){const o=s[0].length;t.text=e.slice(o),t.index+=o;const{content:i,next:a}=ut(t),n=`<div class="h${s[0].length-1}">${i}</div>`;return t.res.push(n),t.text=e.slice(o+a),t.index+=a,!0}return!1},Ys=t=>{let e=t.text,s=e.match(/^\s*-\s/);if(s==null?void 0:s.length){const o=s[0].length;t.text=e.slice(o),t.index+=o;const{content:i,next:a}=ut(t),n=`<div class="ul${s[0].length-1}">${i}</div>`;return t.res.push(n),t.text=e.slice(o+a),t.index+=a,!0}return!1},It=W("detail",{state:()=>({post:{}}),actions:{async init(t){const e=j();this.post=await e.fetchPostById(t),this.post.content=Gs(this.post.content)},clear(){this.post={}}}});const Qs={},at=t=>(H("data-v-2ab21618"),t=t(),G(),t),Xs=at(()=>l("div",{class:"title"},null,-1)),Zs=at(()=>l("div",{class:"long"},null,-1)),to=at(()=>l("div",{class:"long"},null,-1)),eo=at(()=>l("div",{class:"short"},null,-1));function so(t,e){return u(),d(P,null,[Xs,Zs,to,eo],64)}var ht=x(Qs,[["render",so],["__scopeId","data-v-2ab21618"]]);const oo={key:1,class:"meta"},no={class:"title"},ao={class:"author"},io={class:"time"},ro={class:"categories"},lo={key:1},uo={key:0,class:"description"},co=["innerHTML"],_o=S({setup(t){const[e,s]=[It(),Z()],{post:o}=R(e);return mt(()=>(e.clear(),!0)),(i,a)=>(u(),w(Y,null,{content:c(()=>[_(I,null,{default:c(()=>{var n;return[r(o)?(u(),d("div",oo,[l("div",no,h(r(o).title),1),l("div",ao,"by "+h(((n=r(o).author)==null?void 0:n.username)||""),1),l("div",io,h(r(Q)(r(o).updated_time)),1),l("div",ro,h(r(s).mapCategoryName(r(o).category||[]).join(" / ")),1)])):(u(),w(ht,{key:0}))]}),_:1}),_(I,{class:"main"},{default:c(()=>[r(o)?(u(),d("div",lo,[r(o).description?(u(),d("div",uo,h(r(o).description),1)):O("",!0),l("div",{class:"content",innerHTML:r(o).content},null,8,co)])):(u(),w(ht,{key:0}))]),_:1})]),_:1}))}});var po=x(_o,[["__scopeId","data-v-03de8c08"]]);const go=t=>(H("data-v-585355f8"),t=t(),G(),t),ho=go(()=>l("span",null,"\u6807\u7B7E",-1)),fo={class:"categories"},vo={class:"left"},mo={class:"right"},yo={class:"date"},$o={key:0,class:"post-cat"},wo=S({setup(t){const[e,s,o]=[tt(),j(),Z()];s.fetchPosts();const{posts:i}=R(s);o.init();const{categories:a}=R(o);let n=q("");const p=B=>{n.value===B._id?n.value="":n.value=B._id},v=yt(()=>n.value?i.value.filter(B=>B.category.includes(n.value)):i.value),T=B=>{It().init(B),e.go("post")};return(B,U)=>(u(),w(Y,null,{content:c(()=>[_(I,{class:"categories-wrapper"},{default:c(()=>[ho,l("div",fo,[(u(!0),d(P,null,N(r(a),k=>(u(),w(ot,{active:r(n)===k._id,onClick:F=>p(k)},{default:c(()=>[f(h(k.title),1)]),_:2},1032,["active","onClick"]))),256))])]),_:1}),(u(!0),d(P,null,N(r(v),k=>(u(),w(I,{class:"post",onClick:F=>T(k._id)},{default:c(()=>[l("div",vo,h(k.title||"\u65E0\u6807\u9898"),1),l("div",mo,[l("div",yo,h(r(Q)(k.updated_time)),1),r(a)?(u(),d("div",$o,[(u(!0),d(P,null,N(k.category,F=>{var $;return u(),d("div",null,h(($=r(a).find(E=>E._id===F))==null?void 0:$.title),1)}),256))])):O("",!0)])]),_:2},1032,["onClick"]))),256))]),_:1}))}});var Fo=x(wo,[["__scopeId","data-v-585355f8"]]);const Co={class:"actions"},ko=f("\u63D0\u4EA4"),So=f("\u53D6\u6D88"),Eo=f("\u5220\u9664"),Do={class:"description"},Io=f("\u7F16\u8F91"),xo=S({setup(t){const[e]=[Z()],{categories:s,editing:o}=R(e);e.init();const i=async({remove:a=!1})=>{a?await e.delete():o.value._id?await e.update():await e.add(),e.fetchCategories()};return(a,n)=>(u(),w(Y,null,{content:c(()=>[_(I,{class:"edit-wrapper"},{default:c(()=>[V(l("input",{class:"text-input","onUpdate:modelValue":n[0]||(n[0]=p=>r(o).title=p)},null,512),[[K,r(o).title]]),V(l("input",{class:"text-input","onUpdate:modelValue":n[1]||(n[1]=p=>r(o).description=p)},null,512),[[K,r(o).description]]),l("div",Co,[_(A,{type:"primary",onClick:n[2]||(n[2]=p=>i({}))},{default:c(()=>[ko]),_:1}),r(o).title||r(o).description?(u(),w(A,{key:0,onClick:n[3]||(n[3]=p=>r(e).clear())},{default:c(()=>[So]),_:1})):O("",!0),_(A,{class:"right",onClick:n[4]||(n[4]=p=>i({remove:!0}))},{default:c(()=>[Eo]),_:1})])]),_:1}),(u(!0),d(P,null,N(r(s),p=>(u(),w(I,{class:"category"},{default:c(()=>[l("span",null,h(p.title),1),l("span",Do,h(p.description),1),_(A,{class:"right",onClick:v=>r(e).editing=p},{default:c(()=>[Io]),_:2},1032,["onClick"])]),_:2},1024))),256))]),_:1}))}});var Bo=x(xo,[["__scopeId","data-v-181606c6"]]);const bo=S({setup(t){return(e,s)=>(u(),w(Y,null,{content:c(()=>[]),_:1}))}}),Po=l("div",null,"\u91D1\u989D",-1),To=l("div",null,"\u7C7B\u578B",-1),Ao=l("div",null,"\u65E5\u671F",-1),Oo=l("div",null,"\u5907\u6CE8",-1),Lo=S({setup(t){return(e,s)=>(u(),w(Y,null,{content:c(()=>[_(I,null,{default:c(()=>[Po,To,Ao,Oo]),_:1})]),_:1}))}}),Ro={history:Nt(),routes:[{path:"/",component:Fo},{path:"/message",component:ds},{path:"/profile",component:ze},{path:"/addMessage",component:Bs},{path:"/write",component:Hs},{path:"/post",component:po},{path:"/category",component:Bo},{path:"/playground",component:bo},{path:"/balance",component:Lo}]},ct=Vt(Fe);ct.use(Kt(Ro));ct.use(Wt());ct.mount("#app");
