var Ct=Object.defineProperty,Et=Object.defineProperties;var kt=Object.getOwnPropertyDescriptors;var lt=Object.getOwnPropertySymbols;var Dt=Object.prototype.hasOwnProperty,It=Object.prototype.propertyIsEnumerable;var ct=(t,e,s)=>e in t?Ct(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,dt=(t,e)=>{for(var s in e||(e={}))Dt.call(e,s)&&ct(t,s,e[s]);if(lt)for(var s of lt(e))It.call(e,s)&&ct(t,s,e[s]);return t},_t=(t,e)=>Et(t,kt(e));import{d as E,r as pt,o as l,c as _,a as u,b as d,w as c,e as h,p as J,f as z,g as M,s as O,u as n,h as F,n as ot,t as y,i as B,j as bt,T as gt,K as Tt,F as A,k as xt,l as G,m as nt,q as Bt,v as Pt,x as q,y as W,z as V,A as K,B as at,C as At,D as Lt,E as Ot,G as Nt,H as Ut,I as Rt,J as Mt}from"./vendor.1cb04c33.js";const Vt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}};Vt();var k=(t,e)=>{for(const[s,o]of e)t[s]=o;return t};const ht=t=>(J("data-v-7fcf1d58"),t=t(),z(),t),Kt={class:"nav"},Wt={class:"nav-item"},jt=h("\u6587\u5B57"),Ht={class:"nav-item"},Gt=h("\u53D1\u8A00"),Jt={class:"nav-item pg"},zt=ht(()=>u("div",null,"play",-1)),qt=ht(()=>u("div",null,"ground",-1)),Yt={class:"nav-item"},Qt=h("\u4E2A\u4EBA"),Xt=E({setup(t){return(e,s)=>{const o=pt("router-link");return l(),_("div",Kt,[u("div",Wt,[d(o,{to:"/"},{default:c(()=>[jt]),_:1})]),u("div",Ht,[d(o,{to:"/message"},{default:c(()=>[Gt]),_:1})]),u("div",Jt,[d(o,{to:"/playground"},{default:c(()=>[zt,qt]),_:1})]),u("div",Yt,[d(o,{to:"/profile"},{default:c(()=>[Qt]),_:1})])])}}});var Zt=k(Xt,[["__scopeId","data-v-7fcf1d58"]]);const te=2e3,ee={"?":"https://pt-starimg.didistatic.com/static/starimg/img/KY7KIe3Q4q1639999226185.png","!":"https://pt-starimg.didistatic.com/static/starimg/img/jGg8Oue4V41639999416168.png",OK:"https://pt-starimg.didistatic.com/static/starimg/img/iHBDA1efzF1637660245957.png",ERR:"https://pt-starimg.didistatic.com/static/starimg/img/lbgKE9Icl91639038730163.png",LOADING:""},H=M("toast",{state:()=>({show:!1,type:"",icon:"",content:"",timer:0}),actions:{showToast({content:t,type:e,timeout:s=te}){!t||(this.show&&clearTimeout(this.timer),this.content=t,this.type=e,this.icon=ee[e],this.show=!0,this.timer=setTimeout(this.clear,s))},clear(){this.show=!1,this.content=""}}});const se=t=>(J("data-v-e218da6c"),t=t(),z(),t),oe={viewBox:"0 0 50 50",class:"loading-svg"},ne=se(()=>u("circle",{cx:"25",cy:"25",r:"20",fill:"none",class:"path"},null,-1)),ae=[ne],ie=E({setup(t){return(e,s)=>(l(),_("svg",oe,ae))}});var re=k(ie,[["__scopeId","data-v-e218da6c"]]);const ue={key:0,class:"toast-wrapper"},le={class:"toast"},ce={class:"content"},de=E({setup(t){const e=H(),{type:s,show:o,content:i,icon:r}=O(e);return(a,p)=>n(o)?(l(),_("div",ue,[u("div",le,[n(s)==="loading"?(l(),F(re,{key:0})):(l(),_("div",{key:1,class:"icon",style:ot({"background-image":`url(${n(r)})`})},null,4)),u("div",ce,y(n(i)),1)])])):B("",!0)}});var _e=k(de,[["__scopeId","data-v-16d3c47b"]]);const pe=location.href.includes("forvera.me")?"online":"local",X=pe==="online"?"http://106.54.172.20:3000/":`http://${location.hostname}:3000/`;async function D(t,e="get",s,o){let i={url:t,baseURL:X,withCredentials:!0,headers:{},method:e};const r=Y(),a=r.userInfo.token;if(a&&(i.headers.Authorization=a),s)if(typeof s=="string")i.data=s,i.headers["Content-Type"]="application/json";else if(s instanceof FormData)i.data=s;else{let p=new FormData;for(let m in s)p.append(m,s[m]);i.data=p}try{return(await bt(i)).data}catch(p){const m=H();if(p.message==="Network Error")return m.showToast({content:"\u7F51\u7EDC\u9519\u8BEF\uFF0C\u53EF\u80FD\u662F\u540E\u53F0\u6302\u4E86\uFF5E",type:"!",timeout:3e3}),{ERRNO:500};const T=p.response.status;return T===401&&(r.isLogin&&m.showToast({content:"\u767B\u5F55\u51ED\u8BC1\u5DF2\u8FC7\u671F\uFF0C\u8BF7\u4FDD\u5B58\u540E\u70B9\u51FB\u4E2A\u4EBA\u91CD\u65B0\u767B\u5F55\u3002",type:"!",timeout:3e3}),r.logout()),{ERRNO:T}}}const Y=M("user",{state:()=>({loginData:{username:"",password:""},userInfo:{username:void 0,token:void 0}}),getters:{isLogin:t=>!!t.userInfo.token},actions:{async getUserInfo(){let t=localStorage.token;if(t){t=`Bearer ${t}`,Object.assign(this.userInfo,{token:t});const e=await D("user/info","POST");if(e&&!(e==null?void 0:e.ERRNO)){const{username:s}=e;s&&(localStorage.username=s,Object.assign(this.userInfo,{username:s}))}else Object.assign(this.userInfo,{token:void 0}),e.ERRNO==401&&H().showToast({content:"\u767B\u5F55\u4FE1\u606F\u5DF2\u5931\u6548\uFF0C\u53EF\u4EE5\u91CD\u65B0\u767B\u5F55\uFF5E",type:"?"})}},async login(){let t,e;if(localStorage.token&&localStorage.username&&(t=localStorage.token,e=localStorage.username),!(t&&e)){const s=this.loginData;if(!(s.username&&s.password))return;t=(await D("auth/login","POST",JSON.stringify(s))).token,e=this.loginData.username}t&&e&&(localStorage.token=t,localStorage.username=e,t=`Bearer ${t}`,Object.assign(this.userInfo,{token:t,username:e}))},async logout(){delete localStorage.token,delete localStorage.username,Object.assign(this.userInfo,{token:void 0,username:void 0})},validateLoginForm(){var t;return!(((t=this.loginData.username)==null?void 0:t.length)<3||this.loginData.password.length<3)},async register(){if(!this.validateLoginForm())return!1;let t=this.loginData;const{token:e,ERRNO:s}=await D("auth/register","POST",JSON.stringify(t));s||Object.assign(this.userInfo,{token:e,username:this.loginData.username})}}}),mt=M("image",{state:()=>({url:""}),getters:{show:t=>!!t.url},actions:{preview(t){t=t.replace("_thumb",""),this.url=t},stopPreview(){this.url=""}}});const ge=t=>(J("data-v-83d3de0e"),t=t(),z(),t),he=ge(()=>u("div",{class:"bg"},null,-1)),me=["src"],fe=E({setup(t){const e=mt(),s=()=>{e.stopPreview()};return(o,i)=>(l(),F(gt,{name:"fade"},{default:c(()=>[n(e).show?(l(),_("div",{key:0,class:"image-preview",onClick:s},[he,u("img",{class:"image",src:n(e).url},null,8,me)])):B("",!0)]),_:1}))}});var ve=k(fe,[["__scopeId","data-v-83d3de0e"]]);const ye=E({setup(t){return Y().getUserInfo(),(s,o)=>{const i=pt("router-view");return l(),_(A,null,[(l(),F(Tt,{exclude:"profile"},[d(i)],1024)),d(gt,{name:"toast-slide"},{default:c(()=>[d(_e,{class:"toast"})]),_:1}),d(Zt),d(ve)],64)}}});const $e={class:"card"},we={key:0,class:"title"},Fe=E({setup(t){const s=xt().title;return(o,i)=>(l(),_("div",$e,[n(s)?(l(),_("div",we,[G(o.$slots,"title",{},void 0,!0)])):B("",!0),G(o.$slots,"default",{},void 0,!0)]))}});var I=k(Fe,[["__scopeId","data-v-46bdb5a3"]]);const Se=t=>(J("data-v-3f52cb66"),t=t(),z(),t),Ce={key:0},Ee=Se(()=>u("svg",{viewBox:"0 0 50 50",class:"loading-svg"},[u("circle",{cx:"25",cy:"25",r:"20",fill:"none",class:"path"})],-1)),ke=[Ee],De={key:1},Ie=E({props:{type:null,loading:null},setup(t){return(e,s)=>(l(),_("div",{class:nt(["button",{primary:t.type=="primary"}])},[t.loading?(l(),_("div",Ce,ke)):(l(),_("div",De,[G(e.$slots,"default",{},void 0,!0)]))],2))}});var x=k(Ie,[["__scopeId","data-v-3f52cb66"]]);const it=M("category",{state:()=>({categories:[],editing:{}}),actions:{init(){this.categories.length||this.fetchCategories()},async fetchCategories(){this.categories=await D("cat")},checkParam(){return this.editing.title&&this.editing.description},clear(){this.editing={}},async add(){!this.checkParam()||await D("cat","POST",JSON.stringify(this.editing))},async update(){!this.checkParam()||!this.editing._id||await D(`cat/${this.editing._id}`,"PUT",JSON.stringify(this.editing))},async delete(){!this.editing._id||(await D(`cat/${this.editing._id}`,"DELETE"),this.clear())}}}),Q=M("main",{state:()=>({posts:[],route:Bt(),router:Pt()}),actions:{async init(){it().fetchCategories()},async go(t){this.router.push(t)}}}),j=M("post",{state:()=>({posts:[],myPosts:[]}),actions:{async fetchPostById(t){return await D(`post/${t}`,"GET")},async createPost(){return await D("post","POST")},async fetchPosts(){this.posts=await D("post")},async fetchMyPosts(){this.myPosts=await D("post/user","POST")},async updatePost(t,e){return await D(`post/${t}`,"PUT",JSON.stringify(e))},async uploadSingleImage(t,e){return await D(`file/uploadSingle/${t}`,"POST",{file:e})},async fetchImagesOfPost(t){return await D(`file/post/${t}`,"POST")},async deletePost(t){return await D(`post/${t}`,"DELETE")}}}),Z=t=>{const e=new Date(t);return`${e.getFullYear()}-${tt(e.getMonth()+1)}-${tt(e.getDate())} ${tt(e.getHours())}:${tt(e.getMinutes())}`},tt=t=>t<10?`0${t}`:`${t}`,ft=t=>new Promise(e=>{const s=new FileReader;s.onload=o=>e({blob:o.target.result,file:t}),s.readAsDataURL(t)}),be=t=>{let e=null;return(...s)=>{e||(t(...s),e=setTimeout(()=>{e=null},1e3))}};function vt(t,e=!1){const s=o=>`${X}${e?o.thumb:o.url}`;return Array.isArray(t)?t.map(s):s(t)}const yt=M("write",{state:()=>({postId:"",post:{},files:[]}),getters:{images:t=>vt(t.files)},actions:{async init(t){const e=j();t?this.post=await e.fetchPostById(t):this.post=await e.createPost(),this.postId=t||this.post._id},changeStatus(){this.post.status===1?this.post.status=0:this.post.status===0&&(this.post.status=1)},async publish(){if(this.post.title.length<1&&this.post.content.length<1)return;let t=_t(dt({},this.post),{time:Date.now()});return await j().updatePost(this.postId,t)},async deletePost(){return await j().deletePost(this.postId)},toggleCategory(t){Array.isArray(this.post.category)?this.post.category.includes(t)?this.post.category.splice(this.post.category.indexOf(t),1):this.post.category.push(t):this.post.category=[t]},async uploadImage(t){await j().uploadSingleImage(this.postId,t),this.initUploadedImages()},async initUploadedImages(){const t=j();this.files=await t.fetchImagesOfPost(this.postId)}}});const Te={class:"flex-center"},xe=h("\u767B\u5F55"),Be=h("\u6CE8\u518C"),Pe=h("\u767B\u51FA"),Ae={class:"actions"},Le=h("\u5199\u6587\u7AE0"),Oe=h("\u7F16\u8F91\u5206\u7C7B"),Ne={class:"my-posts"},Ue={class:"post-info"},Re={class:"title"},Me={class:"desc"},Ve={key:0,class:"status"},Ke={class:"post-actions"},We=h("\u4FEE\u6539"),je=E({setup(t){const[e,s,o,i,r]=[Y(),Q(),j(),yt(),H()],{loginData:a,isLogin:p,userInfo:m}=O(e),{myPosts:T}=O(o);e.login(),e.isLogin&&o.fetchMyPosts();const U=async()=>{await e.login(),e.isLogin?(r.showToast({content:"\u767B\u5F55\u6210\u529F\uFF5E",type:"OK"}),o.fetchMyPosts()):r.showToast({content:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF5E",type:"ERR"})},R=async()=>{if(!await e.register()){console.log("fail");return}o.fetchMyPosts()},L=async()=>{e.logout(),r.showToast({content:"\u5DF2\u767B\u51FA\uFF5E",type:"OK"})},C=q({write:!1,login:!1,register:!1}),w=()=>{s.router.push("write")},b=async()=>{C.value.write=!0,await i.init(),C.value.write=!1,w()},g=async f=>{await i.init(f),w()},v=()=>{s.router.push("category")};return(f,P)=>n(p)?(l(),_(A,{key:1},[d(I,{class:"item user-info-bar"},{default:c(()=>[u("div",null,y(n(m).username),1),d(x,{onClick:L},{default:c(()=>[Pe]),_:1})]),_:1}),d(I,{class:"item"},{default:c(()=>[u("div",Ae,[d(x,{onClick:b,loading:C.value.write},{default:c(()=>[Le]),_:1},8,["loading"]),d(x,{onClick:v},{default:c(()=>[Oe]),_:1})])]),_:1}),u("div",Ne,[(l(!0),_(A,null,W(n(T),$=>(l(),F(I,{class:nt(["item post",{hidden:$.status!==1}])},{default:c(()=>[u("div",Ue,[u("span",Re,y($.title),1),u("span",Me,y(n(Z)($.updated_time)),1),$.status!==1?(l(),_("div",Ve,"\u9690\u85CF")):B("",!0)]),u("div",Ke,[d(x,{onClick:S=>g($._id)},{default:c(()=>[We]),_:2},1032,["onClick"])])]),_:2},1032,["class"]))),256))])],64)):(l(),F(I,{key:0,class:"login-wrapper"},{default:c(()=>[V(u("input",{class:"text-input","onUpdate:modelValue":P[0]||(P[0]=$=>n(a).username=$)},null,512),[[K,n(a).username]]),V(u("input",{class:"text-input","onUpdate:modelValue":P[1]||(P[1]=$=>n(a).password=$),type:"password"},null,512),[[K,n(a).password]]),u("div",Te,[d(x,{type:"primary",onClick:U,loading:C.value.login},{default:c(()=>[xe]),_:1},8,["loading"]),d(x,{onClick:R,loading:C.value.register},{default:c(()=>[Be]),_:1},8,["loading"])])]),_:1}))}});var He=k(je,[["__scopeId","data-v-140a16b6"]]);const $t=M("message",{state:()=>({messages:[],messageInput:{content:"",files:[],parent:"",ancestor:"",progress:0},messageWrapper:{replyToUsername:"",anonymous:!0},page:0,loading:!1,anonymousNameList:[]}),actions:{reply(t){this.clearMessageInput(),t&&(this.messageInput.parent=t._id,this.messageInput.ancestor=t.level===0?t._id:t.ancestor,this.messageWrapper.replyToUsername=t.user.username)},clearMessageInput(){this.messageInput={content:"",files:[],parent:"",ancestor:"",progress:0},this.messageWrapper.replyToUsername=""},async fetchMessages(t=!1){if(t&&(this.page=0,this.messages=[]),this.loading)return;this.loading=!0;let e=await D(`twit/${this.page}`);return e.forEach(s=>{s.files.forEach(o=>{o.url=`${X}${o.url}`,o.thumb=`${X}${o.thumb}`})}),e.length>0&&(this.mapAnonymousName(e),this.messages.push(...e),this.page++),this.loading=!1,e},mapAnonymousName(t){this.anonymousNameList.length===60&&t.map(e=>{if(e.user.username==="anonymous"){const s=new Date(e.created_time).getSeconds();e.user.username=this.anonymousNameList[s]}})},async fetchAnonymousList(){if(localStorage.anonymousNameList)this.anonymousNameList=JSON.parse(localStorage.anonymousNameList);else{const t=await D("user/anonymous","GET");(t==null?void 0:t.length)===60&&(this.anonymousNameList=t,localStorage.anonymousNameList=JSON.stringify(t))}this.mapAnonymousName(this.messages)},async addMessage(){const{content:t,parent:e,ancestor:s,files:o}=this.messageInput,{anonymous:i}=this.messageWrapper,r=i?"twit/anonymous":"twit",a=new FormData;if(a.append("content",t),e&&s&&(a.append("parent",e),a.append("ancestor",s)),!i)for(let m of o)a.append("files",m);return await D(r,"POST",a,{upload:!0,progress:this.messageInput})}}});const Ge={class:"gallery"},Je=["onClick"],ze=E({props:{images:null,onClick:null},setup(t){return(e,s)=>(l(),_("div",Ge,[(l(!0),_(A,null,W(t.images,(o,i)=>(l(),_("div",{class:"item",style:ot({backgroundImage:`url(${o})`}),onClick:at(r=>{var a;return(a=t.onClick)==null?void 0:a.call(t,t.images,i)},["stop"])},null,12,Je))),256))]))}});var qe=k(ze,[["__scopeId","data-v-8e7169ee"]]);const Ye={class:"header"},Qe={class:"name"},Xe={class:"date"},Ze={class:"content"},ts={key:1,class:"reply-wrapper"},es=["onClick"],ss={class:"header"},os={class:"name"},ns={key:0,class:"name"},as={class:"date"},is={class:"content"},rs=E({setup(t){const[e,s,o,i,r]=[$t(),Y(),Q(),H(),mt()],{messages:a,messageInput:p,messageWrapper:m}=O(e);O(s),e.fetchMessages(!0),e.fetchAnonymousList();const T=be(async()=>{let w=await e.fetchMessages();w&&w.length<=0&&i.showToast({content:"\u6CA1\u6709\u66F4\u591A\u5566",type:"!"})}),U=()=>{document.documentElement.scrollTop+window.innerHeight>=document.body.clientHeight-10*16&&T()};window.addEventListener("scroll",U),At(()=>window.removeEventListener("scroll",U));const R=(w,b)=>{let g;if(b.level===1){const v=w.descendants.find(f=>f._id===b.parent);v&&(g=v.user.username)}return g},L=(w,b)=>{r.preview(w[b])},C=w=>{e.reply(w),o.router.push("addMessage")};return(w,b)=>(l(),_(A,null,[(l(!0),_(A,null,W(n(a),g=>(l(),F(I,{class:"message",onClick:v=>C(g)},{default:c(()=>{var v;return[u("div",Ye,[u("div",Qe,y(g.user.username),1),u("div",Xe,y(n(Z)(g.created_time)),1)]),u("div",Ze,y(g.content),1),g.files.length?(l(),F(qe,{key:0,class:"gallery",images:g.files.map(f=>f.thumb),onClick:L},null,8,["images"])):B("",!0),((v=g.descendants)==null?void 0:v.length)>0?(l(),_("div",ts,[(l(!0),_(A,null,W(g.descendants,f=>(l(),_("div",{class:"reply",onClick:at(P=>C(f),["stop"])},[u("div",ss,[u("div",os,y(f.user.username),1),R(g,f)?(l(),_("div",ns,": "+y(R(g,f)),1)):B("",!0)]),u("div",as,y(n(Z)(f.created_time)),1),u("div",is,y(f.content),1)],8,es))),256))])):B("",!0)]}),_:2},1032,["onClick"]))),256)),u("div",{class:"send",onClick:b[0]||(b[0]=g=>C())})],64))}});var us=k(rs,[["__scopeId","data-v-4bd8c0b9"]]);const ls=E({props:{active:null},setup(t){return(e,s)=>(l(),_("div",{class:nt(["label",{active:t.active}])},[G(e.$slots,"default",{},void 0,!0)],2))}});var rt=k(ls,[["__scopeId","data-v-6454c012"]]);const cs=h("\u9009\u62E9"),ds=["multiple"],_s=E({props:{change:null,multiple:null},setup(t){const{change:e,multiple:s=!1}=t,o=q({}),i=()=>{o.value.click()},r=a=>{e(a.target)};return(a,p)=>(l(),_(A,null,[d(x,{onClick:i},{default:c(()=>[cs]),_:1}),u("input",{ref:(m,T)=>{T.fileInput=m,o.value=m},class:"input",type:"file",onChange:r,multiple:t.multiple},null,40,ds)],64))}});var wt=k(_s,[["__scopeId","data-v-396daa4d"]]);const ps={class:"gallery-wrapper"},gs={class:"gallery"},hs=["onClick","onDragstart","onDragenter"],ms=E({props:{images:null,onClick:null,isDraggable:null,onDrag:null,onRemove:null},setup(t){const{isDraggable:e=!1,onDrag:s,onRemove:o}=t;let i,r,a=q(!1);const p=L=>{i=L,a.value=!0,console.log(a)},m=L=>{r=L,r!==void 0&&i!==void 0&&(s==null||s(r,i),i=r)},T=()=>{r===-1&&i!==void 0&&(o==null||o(i)),i=r=void 0,a.value=!1},U=()=>{r=-1},R=()=>{r=void 0};return(L,C)=>(l(),_("div",ps,[u("div",gs,[(l(!0),_(A,null,W(t.images,(w,b)=>(l(),_("div",{class:"item",style:ot({backgroundImage:`url(${w})`}),onClick:g=>{var v;return(v=t.onClick)==null?void 0:v.call(t,b)},draggable:"true",onDragstart:g=>p(b),onDragenter:g=>m(b),onDragend:C[0]||(C[0]=g=>T())},null,44,hs))),256))]),n(a)?(l(),_("div",{key:0,class:"remove",onDragenter:U,onDragleave:R,onDragover:C[1]||(C[1]=at(()=>{},["prevent"]))},null,32)):B("",!0)]))}});var Ft=k(ms,[["__scopeId","data-v-70031f44"]]);const et=t=>(J("data-v-37b6ade2"),t=t(),z(),t),fs={class:"content"},vs={class:"tips"},ys=et(()=>u("br",null,null,-1)),$s=h(" - \u9000\u51FA\u9875\u9762\u4F1A\u6E05\u7A7A\uFF0C\u4E0D\u8981\u5728\u8FD9\u91CC\u6253\u4E00\u5806\u5B57\u54E6\u3002"),ws=et(()=>u("br",null,null,-1)),Fs=et(()=>u("br",null,null,-1)),Ss={class:"actions"},Cs={class:"right"},Es=et(()=>u("div",{class:"icon"},null,-1)),ks=E({props:{msg:null},setup(t){const[e,s,o,i]=[$t(),Y(),H(),Q()],{messageInput:r,messageWrapper:a}=O(e),{isLogin:p}=O(s),m=Lt([]),T=Ot(()=>m.map(g=>g.blob)),U=async g=>{const v=g.files;if(v==null?void 0:v.length){const f=Array.from(v),P=await Promise.all(f.map(ft));m.push(...P),e.messageInput.files=m.map($=>$.file)}},R=(g,v)=>{const f=m.splice(v,1)[0];m.splice(g,0,f),e.messageInput.files=m.map(P=>P.file)},L=g=>{m.splice(g,1),e.messageInput.files=m.map(v=>v.file)},C=a.value.replyToUsername?`\u56DE\u590D${a.value.replyToUsername}`:"\u53D1\u9001",w=async()=>{if(!r.value.content.length){o.showToast({content:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",type:"ERR"});return}if(r.value.content.length<4){o.showToast({content:`\u5185\u5BB9\u5C11\u4E8E${r.value.content.length}\u4E2A\u5B57\u4E5F\u4E0D\u884C`,type:"ERR"});return}await e.addMessage(),o.showToast({content:"\u53D1\u9001\u6210\u529F\uFF5E",type:"OK"}),i.router.go(-1)},b=()=>{!p.value||e.$patch({messageWrapper:{anonymous:!a.value.anonymous}})};return(g,v)=>(l(),F(I,{class:"input-wrapper"},{default:c(()=>{var f;return[u("div",fs,[u("div",vs,[h(" - "+y(n(s).isLogin?"":"\u5F53\u524D\u672A\u767B\u5F55\uFF0C\u767B\u5F55\u540E")+"\u53EF\u4EE5"+y(n(a).replyToUsername?"":"\u9644\u5E26\u6700\u591A3\u5F20\u56FE\u7247\u548C")+"\u5207\u6362\u8EAB\u4EFD\u3002",1),ys,$s,ws,h(" - \u6B63\u5728\u4EE5"+y(n(a).anonymous?"\u968F\u673A":n(s).userInfo.username)+"\u8EAB\u4EFD"+y(n(a).replyToUsername?`\u56DE\u590D${n(a).replyToUsername}`:"\u53D1\u8A00")+"\u3002",1),Fs]),V(u("input",{class:"input text-input","onUpdate:modelValue":v[0]||(v[0]=P=>n(r).content=P)},null,512),[[K,n(r).content]]),!n(a).anonymous&&((f=n(T))==null?void 0:f.length)?(l(),F(Ft,{key:0,images:n(T),class:"gallery","is-draggable":!0,onDrag:R,onRemove:L},null,8,["images"])):B("",!0),u("div",Ss,[d(x,{class:"action send",onClick:w},{default:c(()=>[h(y(n(C)),1)]),_:1}),u("div",Cs,[!n(a).anonymous&&!n(a).replyToUsername?(l(),F(wt,{key:0,change:U,multiple:!0})):B("",!0),d(rt,{class:"action",onClick:b,active:n(a).anonymous},{default:c(()=>[h(y(n(a).anonymous?"\u533F\u540D\u4E2D":"\u542F\u7528\u533F\u540D"),1)]),_:1},8,["active"])])])]),Es]}),_:1}))}});var Ds=k(ks,[["__scopeId","data-v-37b6ade2"]]);const Is={},bs={class:"layout-list"};function Ts(t,e){return l(),_(A,null,[G(t.$slots,"layout-title",{class:"title"}),u("div",bs,[G(t.$slots,"content")])],64)}var st=k(Is,[["render",Ts]]);const xs=h("\u6807\u9898"),Bs=h("\u63CF\u8FF0"),Ps=h("\u9009\u62E9\u6807\u7B7E"),As={class:"categories"},Ls=h("\u56FE\u7247"),Os={class:"image-input"},Ns=h("\u4E0A\u4F20"),Us=["src"],Rs=h("\u63D0\u4EA4"),Ms=h("\u5220\u9664"),Vs=E({setup(t){const[e,s,o,i]=[yt(),it(),H(),Q()],{post:r,images:a,files:p}=O(e),{categories:m}=O(s);e.initUploadedImages(),s.init();const T=$=>{var S;return(S=r.value.category)==null?void 0:S.includes($)},U=e.toggleCategory,R=async()=>{await e.publish()&&(o.showToast({content:"\u5DF2\u66F4\u65B0",type:"OK"}),i.go("profile"))},L=async()=>{!confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F")||(await e.deletePost(),o.showToast({content:"\u5DF2\u5220\u9664\uFF5E",type:"OK"}),i.go("profile"))},C=()=>{e.changeStatus()};let w=q({});const b=async $=>{const S=$.files;(S==null?void 0:S.length)&&(w.value=await ft(S[0]))},g=async()=>{e.uploadImage(w.value.file)},v=$=>{const S=vt(p.value[$]);f.value=`<img src="${S}" width="100%">`},f=q(""),P=$=>{$.target.select(),document.execCommand("Copy"),o.showToast({content:"\u5DF2\u590D\u5236\u56FE\u7247\u4EE3\u7801\uFF0C\u8BF7\u7C98\u8D34\u5230\u6587\u7AE0\u4E2D\u3002",type:"OK"})};return($,S)=>(l(),F(st,null,{content:c(()=>[d(I,null,{title:c(()=>[xs]),default:c(()=>[V(u("input",{class:"text-input","onUpdate:modelValue":S[0]||(S[0]=N=>n(r).title=N)},null,512),[[K,n(r).title]])]),_:1}),d(I,null,{title:c(()=>[Bs]),default:c(()=>[V(u("input",{class:"text-input","onUpdate:modelValue":S[1]||(S[1]=N=>n(r).description=N)},null,512),[[K,n(r).description]])]),_:1}),d(I,null,{default:c(()=>[V(u("textarea",{class:"text-input textarea","onUpdate:modelValue":S[2]||(S[2]=N=>n(r).content=N)},null,512),[[K,n(r).content]])]),_:1}),d(I,null,{title:c(()=>[Ps]),default:c(()=>[u("div",As,[(l(!0),_(A,null,W(n(m),N=>(l(),F(rt,{active:T(N._id),onClick:_o=>n(U)(N._id)},{default:c(()=>[h(y(N.title),1)]),_:2},1032,["active","onClick"]))),256))])]),_:1}),d(I,null,{title:c(()=>[Ls]),default:c(()=>[u("div",Os,[d(wt,{change:b,multiple:!1}),d(x,{class:"upload-btn",onClick:g},{default:c(()=>[Ns]),_:1}),u("img",{class:"preview",src:n(w).blob},null,8,Us)]),f.value?V((l(),_("textarea",{key:0,class:"copy-container text-input","onUpdate:modelValue":S[3]||(S[3]=N=>f.value=N),readonly:"",onClick:P,rows:"3"},null,512)),[[K,f.value]]):B("",!0),n(a).length>0?(l(),F(Ft,{key:1,images:n(a),onClick:v,class:"gallery"},null,8,["images"])):B("",!0)]),_:1}),d(I,{class:"actions"},{default:c(()=>[d(x,{onClick:R},{default:c(()=>[Rs]),_:1}),d(rt,{onClick:C,active:n(r).status===1},{default:c(()=>[h(y(n(r).status===1?"\u5DF2\u516C\u5F00":"\u5DF2\u9690\u85CF"),1)]),_:1},8,["active"]),d(x,{onClick:L},{default:c(()=>[Ms]),_:1})]),_:1})]),_:1}))}});var Ks=k(Vs,[["__scopeId","data-v-38caf634"]]);const Ws=t=>{let e=t.split(`
`);return e=Hs(e),e.join("")},js=t=>`<p>${t}</p>`,Hs=t=>t.map(e=>{let s=Gs(e)||Js(e);return s?e=s:e=js(e),e}),Gs=t=>{let e=t.match(/^#+\s/);return(e==null?void 0:e.length)?`<div class="h${e[0].length-1}">${t.slice(e[0].length)}</div>`:!1},Js=t=>{let e=t.match(/^\s*-\s/);return(e==null?void 0:e.length)?`<div class="ul${e[0].length-1}">${t.slice(e[0].length)}</div>`:!1},St=M("detail",{state:()=>({post:{}}),actions:{async init(t){const e=j();this.post=await e.fetchPostById(t),this.post.content=Ws(this.post.content)}}});const zs=["innerHTML"],qs=E({setup(t){const[e]=[St()],{post:s}=O(e);return(o,i)=>(l(),F(st,null,{content:c(()=>[d(I,null,{default:c(()=>[h(y(n(s).title),1)]),_:1}),n(s).description?(l(),F(I,{key:0,class:"description"},{default:c(()=>[h(y(n(s).description),1)]),_:1})):B("",!0),d(I,null,{default:c(()=>[u("div",{class:"content",innerHTML:n(s).content},null,8,zs)]),_:1})]),_:1}))}});var Ys=k(qs,[["__scopeId","data-v-0d29379b"]]);const Qs={class:"left"},Xs={class:"right"},Zs={class:"date"},to=E({setup(t){const[e,s]=[Q(),j()],{posts:o}=O(s);s.fetchPosts();const i=r=>{St().init(r),e.go("post")};return(r,a)=>(l(),F(st,null,{content:c(()=>[(l(!0),_(A,null,W(n(o),p=>(l(),F(I,{class:"post",onClick:m=>i(p._id)},{default:c(()=>[u("div",Qs,y(p.title||"\u65E0\u6807\u9898"),1),u("div",Xs,[u("div",Zs,y(n(Z)(p.updated_time)),1)])]),_:2},1032,["onClick"]))),256))]),_:1}))}});var eo=k(to,[["__scopeId","data-v-8de41ece"]]);const so={class:"actions"},oo=h("\u63D0\u4EA4"),no=h("\u53D6\u6D88"),ao=h("\u5220\u9664"),io={class:"description"},ro=h("\u7F16\u8F91"),uo=E({setup(t){const[e]=[it()],{categories:s,editing:o}=O(e);e.init();const i=async({remove:r=!1})=>{r?await e.delete():o.value._id?await e.update():await e.add(),e.fetchCategories()};return(r,a)=>(l(),F(st,null,{content:c(()=>[d(I,{class:"edit-wrapper"},{default:c(()=>[V(u("input",{class:"text-input","onUpdate:modelValue":a[0]||(a[0]=p=>n(o).title=p)},null,512),[[K,n(o).title]]),V(u("input",{class:"text-input","onUpdate:modelValue":a[1]||(a[1]=p=>n(o).description=p)},null,512),[[K,n(o).description]]),u("div",so,[d(x,{type:"primary",onClick:a[2]||(a[2]=p=>i({}))},{default:c(()=>[oo]),_:1}),n(o).title||n(o).description?(l(),F(x,{key:0,onClick:a[3]||(a[3]=p=>n(e).clear())},{default:c(()=>[no]),_:1})):B("",!0),d(x,{class:"right",onClick:a[4]||(a[4]=p=>i({remove:!0}))},{default:c(()=>[ao]),_:1})])]),_:1}),(l(!0),_(A,null,W(n(s),p=>(l(),F(I,{class:"category"},{default:c(()=>[u("span",null,y(p.title),1),u("span",io,y(p.description),1),d(x,{class:"right",onClick:m=>n(e).editing=p},{default:c(()=>[ro]),_:2},1032,["onClick"])]),_:2},1024))),256))]),_:1}))}});var lo=k(uo,[["__scopeId","data-v-9e83d354"]]);const co={history:Nt(),routes:[{path:"/",component:eo},{path:"/message",component:us},{path:"/profile",component:He},{path:"/addMessage",component:Ds},{path:"/write",component:Ks},{path:"/post",component:Ys},{path:"/category",component:lo}]},ut=Ut(ye);ut.use(Rt(co));ut.use(Mt());ut.mount("#app");
