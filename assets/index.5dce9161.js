var Be=Object.defineProperty,Pe=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var he=(e,t,s)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,fe=(e,t)=>{for(var s in t||(t={}))Oe.call(t,s)&&he(e,s,t[s]);if(ge)for(var s of ge(t))Le.call(t,s)&&he(e,s,t[s]);return e},me=(e,t)=>Pe(e,Ae(t));import{d as K,a as Re,u as ye,b as Ue,c as I,e as Me,r as re,o as u,f as d,g as r,h as p,w as c,i as l,j as w,k as $,p as H,l as G,s as M,n as le,t as f,m as O,T as $e,K as Ne,F as A,q as Ve,v as Q,x as ue,y as J,z as U,A as V,B as j,C as ce,D as we,E as Fe,G as ie,H as je,I as Ke,J as We,L as He}from"./vendor.2384a6e0.js";const Ge=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}};Ge();const Je=location.href.includes("forvera.me")?"online":"local",se=Je==="online"?"http://106.54.172.20:3000/":`http://${location.hostname}:3000/`,ze=2e3,Ye={"?":"https://pt-starimg.didistatic.com/static/starimg/img/KY7KIe3Q4q1639999226185.png","!":"https://pt-starimg.didistatic.com/static/starimg/img/jGg8Oue4V41639999416168.png",OK:"https://pt-starimg.didistatic.com/static/starimg/img/iHBDA1efzF1637660245957.png",ERR:"https://pt-starimg.didistatic.com/static/starimg/img/lbgKE9Icl91639038730163.png",LOADING:""},z=K("toast",{state:()=>({show:!1,type:"",icon:"",content:"",timer:0}),actions:{showToast({content:e,type:t,timeout:s=ze}){!e||(this.show&&clearTimeout(this.timer),this.content=e,this.type=t,this.icon=Ye[t],this.show=!0,this.timer=setTimeout(this.clear,s))},clear(){this.show=!1,this.content=""}}}),Z=K("user",{state:()=>({loginData:{username:"",password:""},userInfo:{username:void 0,token:void 0}}),getters:{isLogin:e=>!!e.userInfo.token},actions:{async getUserInfo(){let e=localStorage.token;if(e){e=`Bearer ${e}`,Object.assign(this.userInfo,{token:e});const t=await P("user/info","POST");if(t&&!(t==null?void 0:t.ERRNO)){const{username:s}=t;s&&(localStorage.username=s,Object.assign(this.userInfo,{username:s}))}else Object.assign(this.userInfo,{token:void 0}),t.ERRNO==401&&z().showToast({content:"\u767B\u5F55\u4FE1\u606F\u5DF2\u5931\u6548\uFF0C\u53EF\u4EE5\u91CD\u65B0\u767B\u5F55\uFF5E",type:"?"})}},async login(){let e,t;if(localStorage.token&&localStorage.username&&(e=localStorage.token,t=localStorage.username),!(e&&t)){const s=this.loginData;if(!(s.username&&s.password))return;e=(await P("auth/login","POST",JSON.stringify(s))).token,t=this.loginData.username}e&&t&&(localStorage.token=e,localStorage.username=t,e=`Bearer ${e}`,Object.assign(this.userInfo,{token:e,username:t}))},async logout(){delete localStorage.token,delete localStorage.username,Object.assign(this.userInfo,{token:void 0,username:void 0})},validateLoginForm(){var e;return!(((e=this.loginData.username)==null?void 0:e.length)<3||this.loginData.password.length<3)},async register(){if(!this.validateLoginForm())return!1;let e=this.loginData;const{token:t,ERRNO:s}=await P("auth/register","POST",JSON.stringify(e));s||Object.assign(this.userInfo,{token:t,username:this.loginData.username})}}});async function P(e,t="get",s,o){var _;let a={url:e,baseURL:se,withCredentials:(_=o==null?void 0:o.withCredentials)!=null?_:!0,headers:{},method:t};const i=Z(),n=i.userInfo.token;if(n&&(a.headers.Authorization=n),s)if(typeof s=="string")a.data=s,a.headers["Content-Type"]="application/json";else if(s instanceof FormData)a.data=s;else{let g=new FormData;for(let C in s)g.append(C,s[C]);a.data=g}try{return(await Re(a)).data}catch(g){const C=z();if(g.message==="Network Error")return C.showToast({content:"\u7F51\u7EDC\u9519\u8BEF\uFF0C\u53EF\u80FD\u662F\u540E\u53F0\u6302\u4E86\uFF5E",type:"!",timeout:3e3}),{ERRNO:500};const T=g.response.status;return T===401&&(i.isLogin&&C.showToast({content:"\u767B\u5F55\u51ED\u8BC1\u5DF2\u8FC7\u671F\uFF0C\u8BF7\u4FDD\u5B58\u540E\u70B9\u51FB\u4E2A\u4EBA\u91CD\u65B0\u767B\u5F55\u3002",type:"!",timeout:3e3}),i.logout()),{ERRNO:T}}}const ee=K("category",{state:()=>({categories:[],editing:{},categoryMap:{}}),actions:{init(){this.categories.length||this.fetchCategories()},async fetchCategories(){this.categories=await P("cat"),this.categories.forEach(e=>this.categoryMap[e._id]=e)},checkParam(){return this.editing.title&&this.editing.description},clear(){this.editing={}},async add(){!this.checkParam()||await P("cat","POST",JSON.stringify(this.editing))},async update(){!this.checkParam()||!this.editing._id||await P(`cat/${this.editing._id}`,"PUT",JSON.stringify(this.editing))},async delete(){!this.editing._id||(await P(`cat/${this.editing._id}`,"DELETE"),this.clear())},mapCategoryName(e){return e.map(t=>this.categoryMap[t].title)}}}),X=K("main",{state:()=>({posts:[],route:ye(),router:Ue()}),actions:{async init(){ee().fetchCategories()},async go(e){this.router.push(e)}}}),de=K("message",{state:()=>({messages:[],messageInput:{content:"",files:[],parent:"",ancestor:"",progress:0},messageWrapper:{replyToUsername:"",anonymous:!0},page:0,loading:!1,anonymousNameList:[]}),actions:{reply(e){this.clearMessageInput(),e&&(this.messageInput.parent=e._id,this.messageInput.ancestor=e.level===0?e._id:e.ancestor,this.messageWrapper.replyToUsername=e.user.username)},clearMessageInput(){this.messageInput={content:"",files:[],parent:"",ancestor:"",progress:0},this.messageWrapper.replyToUsername=""},async fetchMessages(e=!1){if(e&&(this.page=0,this.messages=[]),this.loading)return;this.loading=!0;let t=await P(`twit/${this.page}`);return t.forEach(s=>{s.files.forEach(o=>{o.url=`${se}${o.url}`,o.thumb=`${se}${o.thumb}`})}),t.length>0&&(this.messages.push(...t),this.page++),this.loading=!1,t},async addMessage(){const{content:e,parent:t,ancestor:s,files:o}=this.messageInput,{anonymous:a}=this.messageWrapper,i=a?"twit/anonymous":"twit",n=new FormData;if(n.append("content",e),t&&s&&(n.append("parent",t),n.append("ancestor",s)),!a)for(let g of o)n.append("files",g);return await P(i,"POST",n)}}});var x=(e,t)=>{const s=e.__vccOpts||e;for(const[o,a]of t)s[o]=a;return s};const ke=e=>(H("data-v-7eed5a50"),e=e(),G(),e),Qe={class:"nav"},qe={class:"nav-item"},Xe=$("\u6587\u5B57"),Ze={class:"nav-item"},et=$("\u53D1\u8A00"),tt={class:"nav-item pg"},st=ke(()=>r("div",null,"play",-1)),ot=ke(()=>r("div",null,"ground",-1)),nt={class:"nav-item"},at=$("\u4E2A\u4EBA"),it=I({setup(e){const t=ye(),s=Me(()=>t.path==="/message"),o=de(),a=X(),i=()=>{o.reply(),a.router.push("addMessage")};return(n,_)=>{const g=re("router-link");return u(),d("div",Qe,[r("div",qe,[p(g,{to:"/"},{default:c(()=>[Xe]),_:1})]),r("div",Ze,[l(s)?(u(),d("div",{key:0,onClick:i,class:"message-icon"})):(u(),w(g,{key:1,to:"/message"},{default:c(()=>[et]),_:1}))]),r("div",tt,[p(g,{to:"/playground"},{default:c(()=>[st,ot]),_:1})]),r("div",nt,[p(g,{to:"/profile"},{default:c(()=>[at]),_:1})])])}}});var rt=x(it,[["__scopeId","data-v-7eed5a50"]]);const lt=e=>(H("data-v-57b8d288"),e=e(),G(),e),ut={viewBox:"0 0 50 50",class:"loading-svg"},ct=lt(()=>r("circle",{cx:"25",cy:"25",r:"20",fill:"none",class:"path"},null,-1)),dt=[ct],_t=I({setup(e){return(t,s)=>(u(),d("svg",ut,dt))}});var Ce=x(_t,[["__scopeId","data-v-57b8d288"]]);const pt={key:0,class:"toast-wrapper"},gt={class:"toast"},ht={class:"content"},ft=I({setup(e){const t=z(),{type:s,show:o,content:a,icon:i}=M(t);return(n,_)=>l(o)?(u(),d("div",pt,[r("div",gt,[l(s)==="loading"?(u(),w(Ce,{key:0})):(u(),d("div",{key:1,class:"icon",style:le({"background-image":`url(${l(i)})`})},null,4)),r("div",ht,f(l(a)),1)])])):O("",!0)}});var mt=x(ft,[["__scopeId","data-v-0bfefd2e"]]);const Se=K("image",{state:()=>({url:""}),getters:{show:e=>!!e.url},actions:{preview(e){e=e.replace("_thumb",""),this.url=e},stopPreview(){this.url=""}}});const vt=e=>(H("data-v-5881608e"),e=e(),G(),e),yt=vt(()=>r("div",{class:"bg"},null,-1)),$t=["src"],wt=I({setup(e){const t=Se(),s=()=>{t.stopPreview()};return(o,a)=>(u(),w($e,{name:"fade"},{default:c(()=>[l(t).show?(u(),d("div",{key:0,class:"image-preview",onClick:s},[yt,r("img",{class:"image",src:l(t).url},null,8,$t)])):O("",!0)]),_:1}))}});var Ft=x(wt,[["__scopeId","data-v-5881608e"]]);const kt=I({setup(e){return Z().getUserInfo(),(s,o)=>{const a=re("router-view");return u(),d(A,null,[(u(),w(Ne,{exclude:"profile"},[p(a)],1024)),p($e,{name:"toast-slide"},{default:c(()=>[p(mt,{class:"toast"})]),_:1}),p(rt),p(Ft)],64)}}});const Ct={class:"card"},St={key:0,class:"title"},Et=I({setup(e){const s=Ve().title;return(o,a)=>(u(),d("div",Ct,[l(s)?(u(),d("div",St,[Q(o.$slots,"title",{},void 0,!0)])):O("",!0),Q(o.$slots,"default",{},void 0,!0)]))}});var D=x(Et,[["__scopeId","data-v-80441538"]]);const Dt=e=>(H("data-v-fb7a8a88"),e=e(),G(),e),It={key:0},xt=Dt(()=>r("svg",{viewBox:"0 0 50 50",class:"loading-svg"},[r("circle",{cx:"25",cy:"25",r:"20",fill:"none",class:"path"})],-1)),bt=[xt],Tt={key:1},Bt=I({props:{type:null,loading:{type:Boolean}},setup(e){return(t,s)=>(u(),d("div",{class:ue(["button",{primary:e.type=="primary"}])},[e.loading?(u(),d("div",It,bt)):(u(),d("div",Tt,[Q(t.$slots,"default",{},void 0,!0)]))],2))}});var L=x(Bt,[["__scopeId","data-v-fb7a8a88"]]);const W=K("post",{state:()=>({posts:[],myPosts:[]}),actions:{async fetchPostById(e){return await P(`post/${e}`,"GET")},async createPost(){return await P("post","POST")},async fetchPosts(){this.posts=await P("post")},async fetchMyPosts(){this.myPosts=await P("post/user","POST")},async updatePost(e,t){return await P(`post/${e}`,"PUT",JSON.stringify(t))},async uploadSingleImage(e,t){return await P(`file/uploadSingle/${e}`,"POST",{file:t})},async fetchImagesOfPost(e){return await P(`file/post/${e}`,"POST")},async deletePost(e){return await P(`post/${e}`,"DELETE")}}}),q=e=>{const t=new Date(e);return`${t.getFullYear()}-${te(t.getMonth()+1)}-${te(t.getDate())} ${te(t.getHours())}:${te(t.getMinutes())}`},te=e=>e<10?`0${e}`:`${e}`,Ee=e=>new Promise(t=>{const s=new FileReader;s.onload=o=>t({blob:o.target.result,file:e}),s.readAsDataURL(e)}),Pt=e=>{let t=null;return(...s)=>{t||(e(...s),t=setTimeout(()=>{t=null},1e3))}};function De(e,t=!1){const s=o=>`${se}${t?o.thumb:o.url}`;return Array.isArray(e)?e.map(s):s(e)}const Ie=K("write",{state:()=>({postId:"",post:{},files:[]}),getters:{images:e=>De(e.files)},actions:{async init(e){const t=W();e?this.post=await t.fetchPostById(e):this.post=await t.createPost(),this.postId=e||this.post._id},changeStatus(){this.post.status===1?this.post.status=0:this.post.status===0&&(this.post.status=1)},async publish(){if(this.post.title.length<1&&this.post.content.length<1)return;let e=me(fe({},this.post),{time:Date.now()});return await W().updatePost(this.postId,e)},async deletePost(){return await W().deletePost(this.postId)},toggleCategory(e){Array.isArray(this.post.category)?this.post.category.includes(e)?this.post.category.splice(this.post.category.indexOf(e),1):this.post.category.push(e):this.post.category=[e]},async uploadImage(e){await W().uploadSingleImage(this.postId,e),this.initUploadedImages()},async initUploadedImages(){const t=await W().fetchImagesOfPost(this.postId);t.map(s=>{s.url=s.url.replaceAll("\\","/")}),this.files=t}}});const At={class:"flex-center"},Ot=$("\u767B\u5F55"),Lt=$("\u6CE8\u518C"),Rt=$("\u767B\u51FA"),Ut={class:"actions"},Mt=$("\u5199\u6587\u7AE0"),Nt=$("\u7F16\u8F91\u5206\u7C7B"),Vt={class:"my-posts"},jt={class:"post-info"},Kt={class:"title"},Wt={class:"desc"},Ht={key:0,class:"status"},Gt={class:"post-actions"},Jt=$("\u4FEE\u6539"),zt=I({setup(e){const[t,s,o,a,i]=[Z(),X(),W(),Ie(),z()],{loginData:n,isLogin:_,userInfo:g}=M(t),{myPosts:C}=M(o);t.login(),t.isLogin&&o.fetchMyPosts();const T=async()=>{await t.login(),t.isLogin?(i.showToast({content:"\u767B\u5F55\u6210\u529F\uFF5E",type:"OK"}),o.fetchMyPosts()):i.showToast({content:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF5E",type:"ERR"})},E=async()=>{if(!await t.register()){console.log("fail");return}o.fetchMyPosts()},B=async()=>{t.logout(),i.showToast({content:"\u5DF2\u767B\u51FA\uFF5E",type:"OK"})},m=J({write:!1,login:!1,register:!1}),v=()=>{s.router.push("write")},k=async()=>{m.value.write=!0,await a.init(),m.value.write=!1,v()},h=async F=>{await a.init(F),v()},y=()=>{s.router.push("category")};return(F,R)=>l(_)?(u(),d(A,{key:1},[p(D,{class:"item user-info-bar"},{default:c(()=>[r("div",null,f(l(g).username),1),p(L,{onClick:B},{default:c(()=>[Rt]),_:1})]),_:1}),p(D,{class:"item"},{default:c(()=>[r("div",Ut,[p(L,{onClick:k,loading:m.value.write},{default:c(()=>[Mt]),_:1},8,["loading"]),p(L,{onClick:y},{default:c(()=>[Nt]),_:1})])]),_:1}),r("div",Vt,[(u(!0),d(A,null,U(l(C),S=>(u(),w(D,{class:ue(["item post",{hidden:S.status!==1}])},{default:c(()=>[r("div",jt,[r("span",Kt,f(S.title),1),r("span",Wt,f(l(q)(S.updated_time)),1),S.status!==1?(u(),d("div",Ht,"\u9690\u85CF")):O("",!0)]),r("div",Gt,[p(L,{onClick:b=>h(S._id)},{default:c(()=>[Jt]),_:2},1032,["onClick"])])]),_:2},1032,["class"]))),256))])],64)):(u(),w(D,{key:0,class:"login-wrapper"},{default:c(()=>[V(r("input",{class:"text-input","onUpdate:modelValue":R[0]||(R[0]=S=>l(n).username=S)},null,512),[[j,l(n).username]]),V(r("input",{class:"text-input","onUpdate:modelValue":R[1]||(R[1]=S=>l(n).password=S),type:"password"},null,512),[[j,l(n).password]]),r("div",At,[p(L,{type:"primary",onClick:T,loading:m.value.login},{default:c(()=>[Ot]),_:1},8,["loading"]),p(L,{onClick:E,loading:m.value.register},{default:c(()=>[Lt]),_:1},8,["loading"])])]),_:1}))}});var Yt=x(zt,[["__scopeId","data-v-14e1d331"]]);const Qt={class:"gallery"},qt=["onClick"],Xt=I({props:{images:null,onClick:null},setup(e){return(t,s)=>(u(),d("div",Qt,[(u(!0),d(A,null,U(e.images,(o,a)=>(u(),d("div",{class:"item",style:le({backgroundImage:`url(${o})`}),onClick:ce(i=>{var n;return(n=e.onClick)==null?void 0:n.call(e,e.images,a)},["stop"])},null,12,qt))),256))]))}});var Zt=x(Xt,[["__scopeId","data-v-36f53590"]]);const es={class:"header"},ts={class:"name"},ss={class:"date"},os={class:"content"},ns={key:1,class:"reply-wrapper"},as=["onClick"],is={class:"header"},rs={class:"name"},ls={key:0,class:"name"},us={class:"date"},cs={class:"content"},ds=I({setup(e){const[t,s,o,a,i]=[de(),Z(),X(),z(),Se()],{messages:n,messageInput:_,messageWrapper:g}=M(t);M(s),t.fetchMessages(!0);const C=Pt(async()=>{let v=await t.fetchMessages();v&&v.length<=0&&a.showToast({content:"\u6CA1\u6709\u66F4\u591A\u5566",type:"!"})}),T=()=>{document.documentElement.scrollTop+window.innerHeight>=document.body.clientHeight-160&&C()};window.addEventListener("scroll",T),we(()=>window.removeEventListener("scroll",T));const E=(v,k)=>{let h;if(k.level===1){const y=v.descendants.find(F=>F._id===k.parent);y&&(h=y.user.username)}return h},B=(v,k)=>{i.preview(v[k])},m=v=>{t.reply(v),o.router.push("addMessage")};return(v,k)=>(u(!0),d(A,null,U(l(n),h=>(u(),w(D,{class:"message",onClick:y=>m(h)},{default:c(()=>{var y;return[r("div",es,[r("div",ts,f(h.user.username),1),r("div",ss,f(l(q)(h.created_time)),1)]),r("div",os,f(h.content),1),h.files.length?(u(),w(Zt,{key:0,class:"gallery",images:h.files.map(F=>F.thumb),onClick:B},null,8,["images"])):O("",!0),((y=h.descendants)==null?void 0:y.length)>0?(u(),d("div",ns,[(u(!0),d(A,null,U(h.descendants,F=>(u(),d("div",{class:"reply",onClick:ce(R=>m(F),["stop"])},[r("div",is,[r("div",rs,f(F.user.username),1),E(h,F)?(u(),d("div",ls,": "+f(E(h,F)),1)):O("",!0)]),r("div",us,f(l(q)(F.created_time)),1),r("div",cs,f(F.content),1)],8,as))),256))])):O("",!0)]}),_:2},1032,["onClick"]))),256))}});var _s=x(ds,[["__scopeId","data-v-03f0926f"]]);const ps=I({props:{active:{type:Boolean}},setup(e){return(t,s)=>(u(),d("div",{class:ue(["label",{active:e.active}])},[Q(t.$slots,"default",{},void 0,!0)],2))}});var oe=x(ps,[["__scopeId","data-v-83f165e8"]]);const gs=$("\u9009\u62E9"),hs=["multiple"],fs=I({props:{change:null,multiple:{type:Boolean}},setup(e){const{change:t,multiple:s=!1}=e,o=J({}),a=()=>{o.value.click()},i=n=>{t(n.target)};return(n,_)=>(u(),d(A,null,[p(L,{onClick:a},{default:c(()=>[gs]),_:1}),r("input",{ref_key:"fileInput",ref:o,class:"input",type:"file",onChange:i,multiple:e.multiple},null,40,hs)],64))}});var xe=x(fs,[["__scopeId","data-v-3e84ab72"]]);const ms={class:"gallery-wrapper"},vs={class:"gallery"},ys=["onClick","onDragstart","onDragenter"],$s=I({props:{images:null,onClick:null,isDraggable:{type:Boolean},onDrag:null,onRemove:null},setup(e){const{isDraggable:t=!1,onDrag:s,onRemove:o}=e;let a,i,n=J(!1);const _=B=>{a=B,n.value=!0,console.log(n)},g=B=>{i=B,i!==void 0&&a!==void 0&&(s==null||s(i,a),a=i)},C=()=>{i===-1&&a!==void 0&&(o==null||o(a)),a=i=void 0,n.value=!1},T=()=>{i=-1},E=()=>{i=void 0};return(B,m)=>(u(),d("div",ms,[r("div",vs,[(u(!0),d(A,null,U(e.images,(v,k)=>(u(),d("div",{class:"item",style:le({backgroundImage:`url(${v})`}),onClick:h=>{var y;return(y=e.onClick)==null?void 0:y.call(e,k)},draggable:"true",onDragstart:h=>_(k),onDragenter:h=>g(k),onDragend:m[0]||(m[0]=h=>C())},null,44,ys))),256))]),l(n)?(u(),d("div",{key:0,class:"remove",onDragenter:T,onDragleave:E,onDragover:m[1]||(m[1]=ce(()=>{},["prevent"]))},null,32)):O("",!0)]))}});var be=x($s,[["__scopeId","data-v-3a7b9a81"]]);const ne=e=>(H("data-v-86a5fe5c"),e=e(),G(),e),ws={class:"content"},Fs={class:"tips"},ks=ne(()=>r("br",null,null,-1)),Cs=$(" - \u9000\u51FA\u9875\u9762\u4F1A\u6E05\u7A7A\uFF0C\u4E0D\u8981\u5728\u8FD9\u91CC\u6253\u4E00\u5806\u5B57\u54E6\u3002"),Ss=ne(()=>r("br",null,null,-1)),Es=ne(()=>r("br",null,null,-1)),Ds={class:"actions"},Is={class:"right"},xs=ne(()=>r("div",{class:"icon"},null,-1)),bs=I({props:{msg:null},setup(e){const[t,s,o,a]=[de(),Z(),z(),X()],{messageInput:i,messageWrapper:n}=M(t),{isLogin:_}=M(s),g=Fe([]),C=ie(()=>g.map(h=>h.blob)),T=async h=>{const y=h.files;if(y==null?void 0:y.length){const F=Array.from(y),R=await Promise.all(F.map(Ee));g.push(...R),t.messageInput.files=g.map(S=>S.file)}},E=(h,y)=>{const F=g.splice(y,1)[0];g.splice(h,0,F),t.messageInput.files=g.map(R=>R.file)},B=h=>{g.splice(h,1),t.messageInput.files=g.map(y=>y.file)},m=n.value.replyToUsername?`\u56DE\u590D${n.value.replyToUsername}`:"\u53D1\u9001",v=async()=>{if(!i.value.content.length){o.showToast({content:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",type:"ERR"});return}if(i.value.content.length<4){o.showToast({content:`\u5185\u5BB9\u5C11\u4E8E${i.value.content.length}\u4E2A\u5B57\u4E5F\u4E0D\u884C`,type:"ERR"});return}await t.addMessage(),o.showToast({content:"\u53D1\u9001\u6210\u529F\uFF5E",type:"OK"}),a.router.go(-1)},k=()=>{!_.value||t.$patch({messageWrapper:{anonymous:!n.value.anonymous}})};return(h,y)=>(u(),w(D,{class:"input-wrapper"},{default:c(()=>{var F;return[r("div",ws,[r("div",Fs,[$(" - "+f(l(s).isLogin?"":"\u5F53\u524D\u672A\u767B\u5F55\uFF0C\u767B\u5F55\u540E")+"\u53EF\u4EE5"+f(l(n).replyToUsername?"":"\u9644\u5E26\u6700\u591A3\u5F20\u56FE\u7247\u548C")+"\u5207\u6362\u8EAB\u4EFD\u3002",1),ks,Cs,Ss,$(" - \u6B63\u5728\u4EE5"+f(l(n).anonymous?"\u968F\u673A":l(s).userInfo.username)+"\u8EAB\u4EFD"+f(l(n).replyToUsername?`\u56DE\u590D${l(n).replyToUsername}`:"\u53D1\u8A00")+"\u3002",1),Es]),V(r("textarea",{class:"input text-input","onUpdate:modelValue":y[0]||(y[0]=R=>l(i).content=R),rows:"3"},null,512),[[j,l(i).content]]),!l(n).anonymous&&((F=l(C))==null?void 0:F.length)?(u(),w(be,{key:0,images:l(C),class:"gallery","is-draggable":!0,onDrag:E,onRemove:B},null,8,["images"])):O("",!0),r("div",Ds,[p(L,{class:"action send",onClick:v},{default:c(()=>[$(f(l(m)),1)]),_:1}),r("div",Is,[!l(n).anonymous&&!l(n).replyToUsername?(u(),w(xe,{key:0,change:T,multiple:!0})):O("",!0),p(oe,{class:"action",onClick:k,active:l(n).anonymous},{default:c(()=>[$(f(l(n).anonymous?"\u533F\u540D\u4E2D":"\u542F\u7528\u533F\u540D"),1)]),_:1},8,["active"])])])]),xs]}),_:1}))}});var Ts=x(bs,[["__scopeId","data-v-86a5fe5c"]]);const Bs={},Ps={class:"layout-list"};function As(e,t){return u(),d(A,null,[Q(e.$slots,"layout-title",{class:"title"}),r("div",Ps,[Q(e.$slots,"content")])],64)}var Y=x(Bs,[["render",As]]);const Os=$("\u6807\u9898"),Ls=$("\u63CF\u8FF0"),Rs=$("\u9009\u62E9\u6807\u7B7E"),Us={class:"categories"},Ms=$("\u56FE\u7247"),Ns={class:"image-input"},Vs=$("\u4E0A\u4F20"),js=["src"],Ks=$("\u63D0\u4EA4"),Ws=$("\u5220\u9664"),Hs=I({setup(e){const[t,s,o,a]=[Ie(),ee(),z(),X()],{post:i,images:n,files:_}=M(t),{categories:g}=M(s);t.initUploadedImages(),s.init();const C=S=>{var b;return(b=i.value.category)==null?void 0:b.includes(S)},T=t.toggleCategory,E=async()=>{await t.publish()&&(o.showToast({content:"\u5DF2\u66F4\u65B0",type:"OK"}),a.go("profile"))},B=async()=>{!confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F")||(await t.deletePost(),o.showToast({content:"\u5DF2\u5220\u9664\uFF5E",type:"OK"}),a.go("profile"))},m=()=>{t.changeStatus()};let v=J({});const k=async S=>{const b=S.files;(b==null?void 0:b.length)&&(v.value=await Ee(b[0]))},h=async()=>{t.uploadImage(v.value.file)},y=S=>{const b=De(_.value[S]);F.value=`<img src="${b}" width="auto">`},F=J(""),R=S=>{S.target.select(),document.execCommand("Copy"),o.showToast({content:"\u5DF2\u590D\u5236\u56FE\u7247\u4EE3\u7801\uFF0C\u8BF7\u7C98\u8D34\u5230\u6587\u7AE0\u4E2D\u3002",type:"OK"})};return(S,b)=>(u(),w(Y,null,{content:c(()=>[p(D,null,{title:c(()=>[Os]),default:c(()=>[V(r("input",{class:"text-input","onUpdate:modelValue":b[0]||(b[0]=N=>l(i).title=N)},null,512),[[j,l(i).title]])]),_:1}),p(D,null,{title:c(()=>[Ls]),default:c(()=>[V(r("input",{class:"text-input","onUpdate:modelValue":b[1]||(b[1]=N=>l(i).description=N)},null,512),[[j,l(i).description]])]),_:1}),p(D,null,{default:c(()=>[V(r("textarea",{class:"text-input textarea","onUpdate:modelValue":b[2]||(b[2]=N=>l(i).content=N),rows:"15"},null,512),[[j,l(i).content]])]),_:1}),p(D,null,{title:c(()=>[Rs]),default:c(()=>[r("div",Us,[(u(!0),d(A,null,U(l(g),N=>(u(),w(oe,{active:C(N._id),onClick:Qo=>l(T)(N._id)},{default:c(()=>[$(f(N.title),1)]),_:2},1032,["active","onClick"]))),256))])]),_:1}),p(D,null,{title:c(()=>[Ms]),default:c(()=>[r("div",Ns,[p(xe,{change:k,multiple:!1}),p(L,{class:"upload-btn",onClick:h},{default:c(()=>[Vs]),_:1}),r("img",{class:"preview",src:l(v).blob},null,8,js)]),F.value?V((u(),d("textarea",{key:0,class:"copy-container text-input","onUpdate:modelValue":b[3]||(b[3]=N=>F.value=N),readonly:"",onClick:R,rows:"3"},null,512)),[[j,F.value]]):O("",!0),l(n).length>0?(u(),w(be,{key:1,images:l(n),onClick:y,class:"gallery"},null,8,["images"])):O("",!0)]),_:1}),p(D,{class:"actions"},{default:c(()=>[p(L,{onClick:E},{default:c(()=>[Ks]),_:1}),p(oe,{onClick:m,active:l(i).status===1},{default:c(()=>[$(f(l(i).status===1?"\u5DF2\u516C\u5F00":"\u5DF2\u9690\u85CF"),1)]),_:1},8,["active"]),p(L,{onClick:B},{default:c(()=>[Ws]),_:1})]),_:1})]),_:1}))}});var Gs=x(Hs,[["__scopeId","data-v-2fcc3554"]]);const Js=e=>{const t=new Date;let s=new Proxy({source:e,text:e,finished:!1,index:0,res:[]},{set:function(a,i,n,_){return i==="index"?(n>=Reflect.get(a,"source").length&&Reflect.set(a,"finished",!0),Reflect.set(a,"index",n)):Reflect.set(a,i,n)}}),o=0;for(;!s.finished&&o<2e3;)qs(s)||Qs(s)||(s.text.startsWith("```\n")?Ys(s):zs(s)),o++;return console.log(`parse time: ${new Date().getTime()-t.getTime()}ms`),s.res.join("")},_e=e=>{let t=e.text,s=t.indexOf(`
`),o=s>=0;s=o?s:t.length;const a=o?s+1:s;let i=t.slice(0,s);return i=i.replaceAll(/(?:<img\s.+?>)|(?:[.+](.+?))/g,n=>{const _=n.match(/description="(.+)"/);if(_){const g=`<span class="image-description">${_[1]}</span>`;return n+g}return n}),{content:i,next:a}},zs=e=>{let t=e.text;const{content:s,next:o}=_e(e);e.res.push(`<p>${s}</p>`),e.text=t.slice(o),e.index+=o},Ys=e=>{let t=e.text,s=4;for(;s<t.length&&!(t[s]==="`"&&t.slice(s,s+3)==="```");)s++;const o=t.slice(4,s);e.res.push(`<code>${o}</code>`);const a=t.slice(s+3,s+4)===`
`?s+4:s+3;e.text=t.slice(a),e.index+=a},Qs=e=>{let t=e.text,s=t.match(/^#+\s/);if(s==null?void 0:s.length){const o=s[0].length;e.text=t.slice(o),e.index+=o;const{content:a,next:i}=_e(e),n=`<div class="h${s[0].length-1}">${a}</div>`;return e.res.push(n),e.text=t.slice(o+i),e.index+=i,!0}return!1},qs=e=>{let t=e.text,s=t.match(/^\s*-\s/);if(s==null?void 0:s.length){const o=s[0].length;e.text=t.slice(o),e.index+=o;const{content:a,next:i}=_e(e),n=`<div class="ul${s[0].length-1}">${a}</div>`;return e.res.push(n),e.text=t.slice(o+i),e.index+=i,!0}return!1},Te=K("detail",{state:()=>({post:{}}),actions:{async init(e){const t=W();this.post=await t.fetchPostById(e),this.post.content=Js(this.post.content)},clear(){this.post={}}}});const Xs={},ae=e=>(H("data-v-2ab21618"),e=e(),G(),e),Zs=ae(()=>r("div",{class:"title"},null,-1)),eo=ae(()=>r("div",{class:"long"},null,-1)),to=ae(()=>r("div",{class:"long"},null,-1)),so=ae(()=>r("div",{class:"short"},null,-1));function oo(e,t){return u(),d(A,null,[Zs,eo,to,so],64)}var ve=x(Xs,[["render",oo],["__scopeId","data-v-2ab21618"]]);const no={key:1,class:"meta"},ao={class:"title"},io={class:"author"},ro={class:"time"},lo={class:"categories"},uo={key:1},co={key:0,class:"description"},_o=["innerHTML"],po=I({setup(e){const[t,s]=[Te(),ee()],{post:o}=M(t);return we(()=>(t.clear(),!0)),(a,i)=>(u(),w(Y,null,{content:c(()=>[p(D,null,{default:c(()=>{var n;return[l(o)?(u(),d("div",no,[r("div",ao,f(l(o).title),1),r("div",io,"by "+f(((n=l(o).author)==null?void 0:n.username)||""),1),r("div",ro,f(l(q)(l(o).updated_time)),1),r("div",lo,f(l(s).mapCategoryName(l(o).category||[]).join(" / ")),1)])):(u(),w(ve,{key:0}))]}),_:1}),p(D,{class:"main"},{default:c(()=>[l(o)?(u(),d("div",uo,[l(o).description?(u(),d("div",co,f(l(o).description),1)):O("",!0),r("div",{class:"content",innerHTML:l(o).content},null,8,_o)])):(u(),w(ve,{key:0}))]),_:1})]),_:1}))}});var go=x(po,[["__scopeId","data-v-d2a40b68"]]);const ho=e=>(H("data-v-445f6314"),e=e(),G(),e),fo=ho(()=>r("span",null,"\u6807\u7B7E",-1)),mo={class:"categories"},vo={class:"group-name"},yo={class:"left"},$o={class:"right"},wo={class:"date"},Fo={key:0,class:"post-cat"},ko=I({setup(e){const[t,s,o]=[X(),W(),ee()];s.fetchPosts();const{posts:a}=M(s);o.init();const{categories:i}=M(o),n=ie(()=>{const E=Date.now(),B=3600*24*30*1e3;let m={};const v=[];return C.value.map(k=>{const h=new Date(k.updated_time);if(E-h.getTime()<B)m.name?m.posts.push(k):(m={name:"Recent",posts:[k]},v.push(m));else{const y=`${h.getFullYear()}`;m.name!==y?(m={name:y,posts:[k]},v.push(m)):m.posts.push(k)}}),v});let _=J("");const g=E=>{_.value===E._id?_.value="":_.value=E._id},C=ie(()=>_.value?a.value.filter(E=>E.category.includes(_.value)):a.value),T=E=>{Te().init(E),t.go("post")};return(E,B)=>(u(),w(Y,null,{content:c(()=>[p(D,{class:"categories-wrapper"},{default:c(()=>[fo,r("div",mo,[(u(!0),d(A,null,U(l(i),m=>(u(),w(oe,{active:l(_)===m._id,onClick:v=>g(m)},{default:c(()=>[$(f(m.title),1)]),_:2},1032,["active","onClick"]))),256))])]),_:1}),(u(!0),d(A,null,U(l(n),m=>(u(),d("div",{key:m.name,class:"post-group"},[r("div",vo,f(m.name),1),(u(!0),d(A,null,U(m.posts,v=>(u(),w(D,{class:"post",onClick:k=>T(v._id)},{default:c(()=>[r("div",yo,f(v.title||"\u65E0\u6807\u9898"),1),r("div",$o,[r("div",wo,f(l(q)(v.updated_time)),1),l(i)?(u(),d("div",Fo,[(u(!0),d(A,null,U(v.category,k=>{var h;return u(),d("div",null,f((h=l(i).find(y=>y._id===k))==null?void 0:h.title),1)}),256))])):O("",!0)])]),_:2},1032,["onClick"]))),256))]))),128))]),_:1}))}});var Co=x(ko,[["__scopeId","data-v-445f6314"]]);const So={class:"actions"},Eo=$("\u63D0\u4EA4"),Do=$("\u53D6\u6D88"),Io=$("\u5220\u9664"),xo={class:"description"},bo=$("\u7F16\u8F91"),To=I({setup(e){const[t]=[ee()],{categories:s,editing:o}=M(t);t.init();const a=async({remove:i=!1})=>{i?await t.delete():o.value._id?await t.update():await t.add(),t.fetchCategories()};return(i,n)=>(u(),w(Y,null,{content:c(()=>[p(D,{class:"edit-wrapper"},{default:c(()=>[V(r("input",{class:"text-input","onUpdate:modelValue":n[0]||(n[0]=_=>l(o).title=_)},null,512),[[j,l(o).title]]),V(r("input",{class:"text-input","onUpdate:modelValue":n[1]||(n[1]=_=>l(o).description=_)},null,512),[[j,l(o).description]]),r("div",So,[p(L,{type:"primary",onClick:n[2]||(n[2]=_=>a({}))},{default:c(()=>[Eo]),_:1}),l(o).title||l(o).description?(u(),w(L,{key:0,onClick:n[3]||(n[3]=_=>l(t).clear())},{default:c(()=>[Do]),_:1})):O("",!0),p(L,{class:"right",onClick:n[4]||(n[4]=_=>a({remove:!0}))},{default:c(()=>[Io]),_:1})])]),_:1}),(u(!0),d(A,null,U(l(s),_=>(u(),w(D,{class:"category"},{default:c(()=>[r("span",null,f(_.title),1),r("span",xo,f(_.description),1),p(L,{class:"right",onClick:g=>l(t).editing=_},{default:c(()=>[bo]),_:2},1032,["onClick"])]),_:2},1024))),256))]),_:1}))}});var Bo=x(To,[["__scopeId","data-v-181606c6"]]);const Po=$("\u6700\u8FD1\u66F4\u65B0"),Ao=I({setup(e){return(t,s)=>{const o=re("router-link");return u(),w(Y,null,{content:c(()=>[p(D,null,{default:c(()=>[p(o,{to:"/siteinfo"},{default:c(()=>[Po]),_:1})]),_:1})]),_:1})}}}),Oo=r("div",null,"\u91D1\u989D",-1),Lo=r("div",null,"\u7C7B\u578B",-1),Ro=r("div",null,"\u65E5\u671F",-1),Uo=r("div",null,"\u5907\u6CE8",-1),Mo=I({setup(e){return(t,s)=>(u(),w(Y,null,{content:c(()=>[p(D,null,{default:c(()=>[Oo,Lo,Ro,Uo]),_:1})]),_:1}))}});const No=e=>(H("data-v-84333e00"),e=e(),G(),e),Vo=No(()=>r("div",{class:"title"},"Commits",-1)),jo={class:"commit"},Ko={class:"version"},Wo={class:"title"},Ho={class:"message"},Go={class:"date"},Jo=I({setup(e){const t=J(!1),s=Fe([]);return(async()=>{t.value=!0,(await P("https://api.github.com/repos/EasonApolo/forvera/commits?per_page=5","GET",null,{withCredentials:!1})).map(i=>{let{committer:{date:n},message:_}=i.commit;n=q(n);let[g,C]=_.split(`

`),T;g=g.replace(/(\d\.\d\.\d)\s*/,(E,B)=>(T=B,"")),C&&(C=C.split(`
`)),s.push({date:n,version:T,title:g,content:C})}),t.value=!1})(),(a,i)=>(u(),w(Y,null,{content:c(()=>[p(D,{class:"commits"},{default:c(()=>[Vo,t.value?(u(),w(Ce,{key:0})):O("",!0),(u(!0),d(A,null,U(l(s),n=>(u(),d("div",jo,[r("div",Ko,f(n.version),1),r("div",Wo,f(n.title),1),r("div",Ho,[(u(!0),d(A,null,U(n.content,_=>(u(),d("div",null,f(_),1))),256))]),r("div",Go,f(n.date),1)]))),256))]),_:1})]),_:1}))}});var zo=x(Jo,[["__scopeId","data-v-84333e00"]]);const Yo={history:je(),routes:[{path:"/",component:Co},{path:"/message",component:_s},{path:"/profile",component:Yt},{path:"/addMessage",component:Ts},{path:"/write",component:Gs},{path:"/post",component:go},{path:"/category",component:Bo},{path:"/playground",component:Ao},{path:"/balance",component:Mo},{path:"/siteinfo",component:zo}]},pe=Ke(kt);pe.use(We(Yo));pe.use(He());pe.mount("#app");
