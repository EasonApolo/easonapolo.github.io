var Ae=Object.defineProperty,Oe=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var he=(e,t,s)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ve=(e,t)=>{for(var s in t||(t={}))Re.call(t,s)&&he(e,s,t[s]);if(ge)for(var s of ge(t))Ue.call(t,s)&&he(e,s,t[s]);return e},me=(e,t)=>Oe(e,Le(t));import{d as K,a as T,o as i,c as d,p as J,b as z,e as r,s as M,u,f as $,n as le,t as v,g as O,h as Me,w as c,T as ye,r as $e,i as g,j as we,K as Ne,F as b,k as Q,l as Ve,m as Z,q as He,v as je,x as G,y as H,z as j,A as R,B as w,C as ue,D as Ce,E as re,G as Ke,S as We,H as Ge,I as Je,J as ze,L as Ye,M as Qe}from"./vendor.edff2983.js";const qe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerpolicy&&(a.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?a.credentials="include":l.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(l){if(l.ep)return;l.ep=!0;const a=s(l);fetch(l.href,a)}};qe();const Xe=2e3,Ze={"?":"https://pt-starimg.didistatic.com/static/starimg/img/KY7KIe3Q4q1639999226185.png","!":"https://pt-starimg.didistatic.com/static/starimg/img/jGg8Oue4V41639999416168.png",OK:"https://pt-starimg.didistatic.com/static/starimg/img/iHBDA1efzF1637660245957.png",ERR:"https://pt-starimg.didistatic.com/static/starimg/img/lbgKE9Icl91639038730163.png",LOADING:""},Y=K("toast",{state:()=>({show:!1,type:"",icon:"",content:"",timer:0}),actions:{showToast({content:e,type:t,timeout:s=Xe}){!e||(this.show&&clearTimeout(this.timer),this.content=e,this.type=t,this.icon=Ze[t],this.show=!0,this.timer=setTimeout(this.clear,s))},clear(){this.show=!1,this.content=""}}});var B=(e,t)=>{const s=e.__vccOpts||e;for(const[n,l]of t)s[n]=l;return s};const et=e=>(J("data-v-57b8d288"),e=e(),z(),e),tt={viewBox:"0 0 50 50",class:"loading-svg"},st=et(()=>r("circle",{cx:"25",cy:"25",r:"20",fill:"none",class:"path"},null,-1)),nt=[st],ot=T({setup(e){return(t,s)=>(i(),d("svg",tt,nt))}});var Fe=B(ot,[["__scopeId","data-v-57b8d288"]]);const at={key:0,class:"toast-wrapper"},it={class:"toast"},rt={class:"content"},lt=T({setup(e){const t=Y(),{type:s,show:n,content:l,icon:a}=M(t);return(o,_)=>u(n)?(i(),d("div",at,[r("div",it,[u(s)==="loading"?(i(),$(Fe,{key:0})):(i(),d("div",{key:1,class:"icon",style:le({"background-image":`url(${u(a)})`})},null,4)),r("div",rt,v(u(l)),1)])])):O("",!0)}});var ut=B(lt,[["__scopeId","data-v-3a9023cd"]]);const ct=location.href.includes("forvera.me")?"online":"local",ne=ct==="online"?"http://106.54.172.20:3000/":`http://${location.hostname}:3000/`;async function A(e,t="get",s,n){var o;const l=ee();let a={url:e,baseURL:ne,withCredentials:(o=n==null?void 0:n.withCredentials)!=null?o:!0,headers:{},method:t};if(a.withCredentials){const _=l.userInfo.token;_&&(a.headers.Authorization=_)}if(s)if(typeof s=="string")a.data=s,a.headers["Content-Type"]="application/json";else if(s instanceof FormData)a.data=s;else{let _=new FormData;for(let f in s)_.append(f,s[f]);a.data=_}try{return(await Me(a)).data}catch(_){const f=Y();if(_.message==="Network Error")return f.showToast({content:"\u7F51\u7EDC\u9519\u8BEF\uFF0C\u53EF\u80FD\u662F\u540E\u53F0\u6302\u4E86\uFF5E",type:"!",timeout:3e3}),{ERRNO:500};const k=_.response.status;return k===401&&(l.isLogin&&f.showToast({content:"\u767B\u5F55\u51ED\u8BC1\u5DF2\u8FC7\u671F\uFF0C\u8BF7\u4FDD\u5B58\u540E\u70B9\u51FB\u4E2A\u4EBA\u91CD\u65B0\u767B\u5F55\u3002",type:"!",timeout:3e3}),l.logout()),{ERRNO:k}}}const ee=K("user",{state:()=>({loginData:{username:"",password:""},userInfo:{username:void 0,token:void 0}}),getters:{isLogin:e=>!!e.userInfo.token},actions:{async getUserInfo(){let e=localStorage.token;if(e){e=`Bearer ${e}`,Object.assign(this.userInfo,{token:e});const t=await A("user/info","POST");if(t&&!(t==null?void 0:t.ERRNO)){const{username:s}=t;s&&(localStorage.username=s,Object.assign(this.userInfo,{username:s}))}else Object.assign(this.userInfo,{token:void 0}),t.ERRNO==401&&Y().showToast({content:"\u767B\u5F55\u4FE1\u606F\u5DF2\u5931\u6548\uFF0C\u53EF\u4EE5\u91CD\u65B0\u767B\u5F55\uFF5E",type:"?"})}},async login(){let e,t;if(localStorage.token&&localStorage.username&&(e=localStorage.token,t=localStorage.username),!(e&&t)){const s=this.loginData;if(!(s.username&&s.password))return;e=(await A("auth/login","POST",JSON.stringify(s))).token,t=this.loginData.username}e&&t&&(localStorage.token=e,localStorage.username=t,e=`Bearer ${e}`,Object.assign(this.userInfo,{token:e,username:t}))},async logout(){delete localStorage.token,delete localStorage.username,Object.assign(this.userInfo,{token:void 0,username:void 0})},validateLoginForm(){var e;return!(((e=this.loginData.username)==null?void 0:e.length)<3||this.loginData.password.length<3)},async register(){if(!this.validateLoginForm())return!1;let e=this.loginData;const{token:t,ERRNO:s}=await A("auth/register","POST",JSON.stringify(e));s||Object.assign(this.userInfo,{token:t,username:this.loginData.username})}}}),ke=K("image",{state:()=>({url:""}),getters:{show:e=>!!e.url},actions:{preview(e){e=e.replace("_thumb",""),this.url=e},stopPreview(){this.url=""}}});const dt=e=>(J("data-v-5881608e"),e=e(),z(),e),_t=dt(()=>r("div",{class:"bg"},null,-1)),pt=["src"],gt=T({setup(e){const t=ke(),s=()=>{t.stopPreview()};return(n,l)=>(i(),$(ye,{name:"fade"},{default:c(()=>[u(t).show?(i(),d("div",{key:0,class:"image-preview",onClick:s},[_t,r("img",{class:"image",src:u(t).url},null,8,pt)])):O("",!0)]),_:1}))}});var ht=B(gt,[["__scopeId","data-v-5881608e"]]);const vt=T({setup(e){return ee().getUserInfo(),(s,n)=>{const l=$e("router-view");return i(),d(b,null,[g(l,null,{default:c(({Component:a})=>[(i(),$(Ne,null,[(i(),$(we(a)))],1024))]),_:1}),g(ye,{name:"toast-slide"},{default:c(()=>[g(ut,{class:"toast"})]),_:1}),g(ht)],64)}}});const mt={},ft={class:"list"},yt={class:"layout-list"};function $t(e,t){return i(),d("div",ft,[Q(e.$slots,"layout-title",{class:"title"},void 0,!0),r("div",yt,[Q(e.$slots,"content",{},void 0,!0)])])}var V=B(mt,[["render",$t],["__scopeId","data-v-43cb2c02"]]);const wt={class:"card"},Ct={key:0,class:"title"},Ft=T({setup(e){const s=Ve().title;return(n,l)=>(i(),d("div",wt,[u(s)?(i(),d("div",Ct,[Q(n.$slots,"title",{},void 0,!0)])):O("",!0),Q(n.$slots,"default",{},void 0,!0)]))}});var x=B(Ft,[["__scopeId","data-v-80441538"]]);const kt=e=>(J("data-v-fb7a8a88"),e=e(),z(),e),St={key:0},Et=kt(()=>r("svg",{viewBox:"0 0 50 50",class:"loading-svg"},[r("circle",{cx:"25",cy:"25",r:"20",fill:"none",class:"path"})],-1)),Dt=[Et],It={key:1},xt=T({props:{type:null,loading:{type:Boolean}},setup(e){return(t,s)=>(i(),d("div",{class:Z(["button",{primary:e.type=="primary"}])},[e.loading?(i(),d("div",St,Dt)):(i(),d("div",It,[Q(t.$slots,"default",{},void 0,!0)]))],2))}});var L=B(xt,[["__scopeId","data-v-fb7a8a88"]]);const te=K("category",{state:()=>({categories:[],editing:{},categoryMap:{}}),actions:{init(){this.categories.length||this.fetchCategories()},async fetchCategories(){this.categories=await A("cat"),this.categories.forEach(e=>this.categoryMap[e._id]=e)},checkParam(){return this.editing.title&&this.editing.description},clear(){this.editing={}},async add(){!this.checkParam()||await A("cat","POST",JSON.stringify(this.editing))},async update(){!this.checkParam()||!this.editing._id||await A(`cat/${this.editing._id}`,"PUT",JSON.stringify(this.editing))},async delete(){!this.editing._id||(await A(`cat/${this.editing._id}`,"DELETE"),this.clear())},mapCategoryName(e){return e.map(t=>this.categoryMap[t].title)}}}),X=K("main",{state:()=>({posts:[],route:He(),router:je()}),actions:{async init(){te().fetchCategories()},async go(e){this.router.push(e)}}}),W=K("post",{state:()=>({posts:[],myPosts:[]}),actions:{async fetchPostById(e){return await A(`post/${e}`,"GET")},async createPost(){return await A("post","POST")},async fetchPosts(){this.posts=await A("post")},async fetchMyPosts(){this.myPosts=await A("post/user","POST")},async updatePost(e,t){return await A(`post/${e}`,"PUT",JSON.stringify(t))},async uploadSingleImage(e,t){return await A(`file/uploadSingle/${e}`,"POST",{file:t})},async fetchImagesOfPost(e){return await A(`file/post/${e}`,"POST")},async deletePost(e){return await A(`post/${e}`,"DELETE")}}}),q=e=>{const t=new Date(e);return`${t.getFullYear()}-${se(t.getMonth()+1)}-${se(t.getDate())} ${se(t.getHours())}:${se(t.getMinutes())}`},se=e=>e<10?`0${e}`:`${e}`,Se=e=>new Promise(t=>{const s=new FileReader;s.onload=n=>t({blob:n.target.result,file:e}),s.readAsDataURL(e)}),bt=e=>{let t=null;return(...s)=>{t||(e(...s),t=setTimeout(()=>{t=null},1e3))}};function Ee(e,t=!1){const s=n=>`${ne}${t?n.thumb:n.url}`;return Array.isArray(e)?e.map(s):s(e)}const De=K("write",{state:()=>({postId:"",post:{},files:[]}),getters:{images:e=>Ee(e.files)},actions:{async init(e){const t=W();e?this.post=await t.fetchPostById(e):this.post=await t.createPost(),this.postId=e||this.post._id},changeStatus(){this.post.status===1?this.post.status=0:this.post.status===0&&(this.post.status=1)},async publish(){if(this.post.title.length<1&&this.post.content.length<1)return;let e=me(ve({},this.post),{time:Date.now()});return await W().updatePost(this.postId,e)},async deletePost(){return await W().deletePost(this.postId)},toggleCategory(e){Array.isArray(this.post.category)?this.post.category.includes(e)?this.post.category.splice(this.post.category.indexOf(e),1):this.post.category.push(e):this.post.category=[e]},async uploadImage(e){await W().uploadSingleImage(this.postId,e),this.initUploadedImages()},async initUploadedImages(){const t=await W().fetchImagesOfPost(this.postId);t.map(s=>{s.url=s.url.replaceAll("\\","/")}),this.files=t}}});const Tt={class:"flex-center"},Bt=w("\u767B\u5F55"),Pt=w("\u6CE8\u518C"),At=w("\u767B\u51FA"),Ot={class:"actions"},Lt=w("\u5199\u6587\u7AE0"),Rt=w("\u7F16\u8F91\u5206\u7C7B"),Ut={class:"my-posts"},Mt={class:"post-info"},Nt={class:"title"},Vt={class:"desc"},Ht={key:0,class:"status"},jt={class:"post-actions"},Kt=w("\u4FEE\u6539"),Wt=T({setup(e){const[t,s,n,l,a]=[ee(),X(),W(),De(),Y()],{loginData:o,isLogin:_,userInfo:f}=M(t),{myPosts:k}=M(n);t.login(),t.isLogin&&n.fetchMyPosts();const I=async()=>{await t.login(),t.isLogin?(a.showToast({content:"\u767B\u5F55\u6210\u529F\uFF5E",type:"OK"}),n.fetchMyPosts()):a.showToast({content:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF5E",type:"ERR"})},S=async()=>{if(!await t.register()){console.log("fail");return}n.fetchMyPosts()},E=async()=>{t.logout(),a.showToast({content:"\u5DF2\u767B\u51FA\uFF5E",type:"OK"})},p=G({write:!1,login:!1,register:!1}),m=()=>{s.router.push("write")},F=async()=>{p.value.write=!0,await l.init(),p.value.write=!1,m()},h=async C=>{await l.init(C),m()},y=()=>{s.router.push("category")};return(C,U)=>(i(),$(V,null,{content:c(()=>[u(_)?(i(),d(b,{key:1},[g(x,{class:"item user-info-bar"},{default:c(()=>[r("div",null,v(u(f).username),1),g(L,{onClick:E},{default:c(()=>[At]),_:1})]),_:1}),g(x,{class:"item"},{default:c(()=>[r("div",Ot,[g(L,{onClick:F,loading:p.value.write},{default:c(()=>[Lt]),_:1},8,["loading"]),g(L,{onClick:y},{default:c(()=>[Rt]),_:1})])]),_:1}),r("div",Ut,[(i(!0),d(b,null,R(u(k),D=>(i(),$(x,{class:Z(["item post",{hidden:D.status!==1}])},{default:c(()=>[r("div",Mt,[r("span",Nt,v(D.title),1),r("span",Vt,v(u(q)(D.updated_time)),1),D.status!==1?(i(),d("div",Ht,"\u9690\u85CF")):O("",!0)]),r("div",jt,[g(L,{onClick:P=>h(D._id)},{default:c(()=>[Kt]),_:2},1032,["onClick"])])]),_:2},1032,["class"]))),256))])],64)):(i(),$(x,{key:0,class:"login-wrapper"},{default:c(()=>[H(r("input",{class:"text-input","onUpdate:modelValue":U[0]||(U[0]=D=>u(o).username=D)},null,512),[[j,u(o).username]]),H(r("input",{class:"text-input","onUpdate:modelValue":U[1]||(U[1]=D=>u(o).password=D),type:"password"},null,512),[[j,u(o).password]]),r("div",Tt,[g(L,{type:"primary",onClick:I,loading:p.value.login},{default:c(()=>[Bt]),_:1},8,["loading"]),g(L,{onClick:S,loading:p.value.register},{default:c(()=>[Pt]),_:1},8,["loading"])])]),_:1}))]),_:1}))}});var Ie=B(Wt,[["__scopeId","data-v-9c2f1938"]]);const ce=K("message",{state:()=>({messages:[],messageInput:{content:"",files:[],parent:"",ancestor:"",progress:0},messageWrapper:{replyToUsername:"",anonymous:!0},page:0,loading:!1,anonymousNameList:[]}),actions:{reply(e){this.clearMessageInput(),e&&(this.messageInput.parent=e._id,this.messageInput.ancestor=e.level===0?e._id:e.ancestor,this.messageWrapper.replyToUsername=e.user.username)},clearMessageInput(){this.messageInput={content:"",files:[],parent:"",ancestor:"",progress:0},this.messageWrapper.replyToUsername=""},async fetchMessages(e=!1){if(e&&(this.page=0,this.messages=[]),this.loading)return;this.loading=!0;let t=await A(`twit/${this.page}`);return t.forEach(s=>{s.files.forEach(n=>{n.url=`${ne}${n.url}`,n.thumb=`${ne}${n.thumb}`})}),t.length>0&&(this.messages.push(...t),this.page++),this.loading=!1,t},async addMessage(){const{content:e,parent:t,ancestor:s,files:n}=this.messageInput,{anonymous:l}=this.messageWrapper,a=l?"twit/anonymous":"twit",o=new FormData;if(o.append("content",e),t&&s&&(o.append("parent",t),o.append("ancestor",s)),!l)for(let f of n)o.append("files",f);return await A(a,"POST",o)}}});const Gt={class:"gallery"},Jt=["onClick"],zt=T({props:{images:null,onClick:null},setup(e){return(t,s)=>(i(),d("div",Gt,[(i(!0),d(b,null,R(e.images,(n,l)=>(i(),d("div",{class:"item",style:le({backgroundImage:`url(${n})`}),onClick:ue(a=>{var o;return(o=e.onClick)==null?void 0:o.call(e,e.images,l)},["stop"])},null,12,Jt))),256))]))}});var Yt=B(zt,[["__scopeId","data-v-36f53590"]]);const Qt={class:"header"},qt={class:"name"},Xt={class:"date"},Zt={class:"content"},es={key:1,class:"reply-wrapper"},ts=["onClick"],ss={class:"header"},ns={class:"name"},os={key:0,class:"name"},as={class:"date"},is={class:"content"},rs=T({setup(e){const[t,s,n,l,a]=[ce(),ee(),X(),Y(),ke()],{messages:o,messageInput:_,messageWrapper:f}=M(t);M(s),t.fetchMessages(!0);const k=bt(async()=>{let m=await t.fetchMessages();m&&m.length<=0&&l.showToast({content:"\u6CA1\u6709\u66F4\u591A\u5566",type:"!"})}),I=m=>{let F=m.target.clientHeight,h=m.target.scrollTop,y=m.target.getElementsByClassName("layout-list")[0].clientHeight;h+F>=y-10*16&&k()},S=(m,F)=>{let h;if(F.level===1){const y=m.descendants.find(C=>C._id===F.parent);y&&(h=y.user.username)}return h},E=(m,F)=>{a.preview(m[F])},p=m=>{t.reply(m),n.router.push("addMessage")};return(m,F)=>(i(),$(V,{onScroll:I},{content:c(()=>[(i(!0),d(b,null,R(u(o),h=>(i(),$(x,{class:"message",onClick:y=>p(h)},{default:c(()=>{var y;return[r("div",Qt,[r("div",qt,v(h.user.username),1),r("div",Xt,v(u(q)(h.created_time)),1)]),r("div",Zt,v(h.content),1),h.files.length?(i(),$(Yt,{key:0,class:"gallery",images:h.files.map(C=>C.thumb),onClick:E},null,8,["images"])):O("",!0),((y=h.descendants)==null?void 0:y.length)>0?(i(),d("div",es,[(i(!0),d(b,null,R(h.descendants,C=>(i(),d("div",{class:"reply",onClick:ue(U=>p(C),["stop"])},[r("div",ss,[r("div",ns,v(C.user.username),1),S(h,C)?(i(),d("div",os,": "+v(S(h,C)),1)):O("",!0)]),r("div",as,v(u(q)(C.created_time)),1),r("div",is,v(C.content),1)],8,ts))),256))])):O("",!0)]}),_:2},1032,["onClick"]))),256))]),_:1}))}});var xe=B(rs,[["__scopeId","data-v-195bf406"]]);const ls=T({props:{active:{type:Boolean}},setup(e){return(t,s)=>(i(),d("div",{class:Z(["label",{active:e.active}])},[Q(t.$slots,"default",{},void 0,!0)],2))}});var oe=B(ls,[["__scopeId","data-v-83f165e8"]]);const us=w("\u9009\u62E9"),cs=["multiple"],ds=T({props:{change:null,multiple:{type:Boolean}},setup(e){const{change:t,multiple:s=!1}=e,n=G({}),l=()=>{n.value.click()},a=o=>{t(o.target)};return(o,_)=>(i(),d(b,null,[g(L,{onClick:l},{default:c(()=>[us]),_:1}),r("input",{ref_key:"fileInput",ref:n,class:"input",type:"file",onChange:a,multiple:e.multiple},null,40,cs)],64))}});var be=B(ds,[["__scopeId","data-v-3e84ab72"]]);const _s={class:"gallery-wrapper"},ps={class:"gallery"},gs=["onClick","onDragstart","onDragenter"],hs=T({props:{images:null,onClick:null,isDraggable:{type:Boolean},onDrag:null,onRemove:null},setup(e){const{isDraggable:t=!1,onDrag:s,onRemove:n}=e;let l,a,o=G(!1);const _=E=>{l=E,o.value=!0,console.log(o)},f=E=>{a=E,a!==void 0&&l!==void 0&&(s==null||s(a,l),l=a)},k=()=>{a===-1&&l!==void 0&&(n==null||n(l)),l=a=void 0,o.value=!1},I=()=>{a=-1},S=()=>{a=void 0};return(E,p)=>(i(),d("div",_s,[r("div",ps,[(i(!0),d(b,null,R(e.images,(m,F)=>(i(),d("div",{class:"item",style:le({backgroundImage:`url(${m})`}),onClick:h=>{var y;return(y=e.onClick)==null?void 0:y.call(e,F)},draggable:"true",onDragstart:h=>_(F),onDragenter:h=>f(F),onDragend:p[0]||(p[0]=h=>k())},null,44,gs))),256))]),u(o)?(i(),d("div",{key:0,class:"remove",onDragenter:I,onDragleave:S,onDragover:p[1]||(p[1]=ue(()=>{},["prevent"]))},null,32)):O("",!0)]))}});var Te=B(hs,[["__scopeId","data-v-3a7b9a81"]]);const ae=e=>(J("data-v-1485e096"),e=e(),z(),e),vs={class:"content"},ms={class:"tips"},fs=ae(()=>r("br",null,null,-1)),ys=w(" - \u9000\u51FA\u9875\u9762\u4F1A\u6E05\u7A7A\uFF0C\u4E0D\u8981\u5728\u8FD9\u91CC\u6253\u4E00\u5806\u5B57\u54E6\u3002"),$s=ae(()=>r("br",null,null,-1)),ws=ae(()=>r("br",null,null,-1)),Cs={class:"actions"},Fs={class:"right"},ks=ae(()=>r("div",{class:"icon"},null,-1)),Ss=T({props:{msg:null},setup(e){const[t,s,n,l]=[ce(),ee(),Y(),X()],{messageInput:a,messageWrapper:o}=M(t),{isLogin:_}=M(s),f=Ce([]),k=re(()=>f.map(h=>h.blob)),I=async h=>{const y=h.files;if(y==null?void 0:y.length){const C=Array.from(y),U=await Promise.all(C.map(Se));f.push(...U),t.messageInput.files=f.map(D=>D.file)}},S=(h,y)=>{const C=f.splice(y,1)[0];f.splice(h,0,C),t.messageInput.files=f.map(U=>U.file)},E=h=>{f.splice(h,1),t.messageInput.files=f.map(y=>y.file)},p=o.value.replyToUsername?`\u56DE\u590D${o.value.replyToUsername}`:"\u53D1\u9001",m=async()=>{if(!a.value.content.length){n.showToast({content:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",type:"ERR"});return}if(a.value.content.length<4){n.showToast({content:`\u5185\u5BB9\u5C11\u4E8E${a.value.content.length}\u4E2A\u5B57\u4E5F\u4E0D\u884C`,type:"ERR"});return}await t.addMessage(),n.showToast({content:"\u53D1\u9001\u6210\u529F\uFF5E",type:"OK"}),l.router.go(-1)},F=()=>{!_.value||t.$patch({messageWrapper:{anonymous:!o.value.anonymous}})};return(h,y)=>(i(),$(V,null,{content:c(()=>[g(x,{class:"input-wrapper"},{default:c(()=>{var C;return[r("div",vs,[r("div",ms,[w(" - "+v(u(s).isLogin?"":"\u5F53\u524D\u672A\u767B\u5F55\uFF0C\u767B\u5F55\u540E")+"\u53EF\u4EE5"+v(u(o).replyToUsername?"":"\u9644\u5E26\u6700\u591A3\u5F20\u56FE\u7247\u548C")+"\u5207\u6362\u8EAB\u4EFD\u3002",1),fs,ys,$s,w(" - \u6B63\u5728\u4EE5"+v(u(o).anonymous?"\u968F\u673A":u(s).userInfo.username)+"\u8EAB\u4EFD"+v(u(o).replyToUsername?`\u56DE\u590D${u(o).replyToUsername}`:"\u53D1\u8A00")+"\u3002",1),ws]),H(r("textarea",{class:"input text-input","onUpdate:modelValue":y[0]||(y[0]=U=>u(a).content=U),rows:"3"},null,512),[[j,u(a).content]]),!u(o).anonymous&&((C=u(k))==null?void 0:C.length)?(i(),$(Te,{key:0,images:u(k),class:"gallery","is-draggable":!0,onDrag:S,onRemove:E},null,8,["images"])):O("",!0),r("div",Cs,[g(L,{class:"action send",onClick:m},{default:c(()=>[w(v(u(p)),1)]),_:1}),r("div",Fs,[!u(o).anonymous&&!u(o).replyToUsername?(i(),$(be,{key:0,change:I,multiple:!0})):O("",!0),g(oe,{class:"action",onClick:F,active:u(o).anonymous},{default:c(()=>[w(v(u(o).anonymous?"\u533F\u540D\u4E2D":"\u542F\u7528\u533F\u540D"),1)]),_:1},8,["active"])])])]),ks]}),_:1})]),_:1}))}});var Es=B(Ss,[["__scopeId","data-v-1485e096"]]);const Ds=w("\u6807\u9898"),Is=w("\u63CF\u8FF0"),xs=w("\u9009\u62E9\u6807\u7B7E"),bs={class:"categories"},Ts=w("\u56FE\u7247"),Bs={class:"image-input"},Ps=w("\u4E0A\u4F20"),As=["src"],Os=w("\u63D0\u4EA4"),Ls=w("\u5220\u9664"),Rs=T({setup(e){const[t,s,n,l]=[De(),te(),Y(),X()],{post:a,images:o,files:_}=M(t),{categories:f}=M(s);t.initUploadedImages(),s.init();const k=D=>{var P;return(P=a.value.category)==null?void 0:P.includes(D)},I=t.toggleCategory,S=async()=>{await t.publish()&&(n.showToast({content:"\u5DF2\u66F4\u65B0",type:"OK"}),l.go("profile"))},E=async()=>{!confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F")||(await t.deletePost(),n.showToast({content:"\u5DF2\u5220\u9664\uFF5E",type:"OK"}),l.go("profile"))},p=()=>{t.changeStatus()};let m=G({});const F=async D=>{const P=D.files;(P==null?void 0:P.length)&&(m.value=await Se(P[0]))},h=async()=>{t.uploadImage(m.value.file)},y=D=>{const P=Ee(_.value[D]);C.value=`<img src="${P}" width="auto">`},C=G(""),U=D=>{D.target.select(),document.execCommand("Copy"),n.showToast({content:"\u5DF2\u590D\u5236\u56FE\u7247\u4EE3\u7801\uFF0C\u8BF7\u7C98\u8D34\u5230\u6587\u7AE0\u4E2D\u3002",type:"OK"})};return(D,P)=>(i(),$(V,null,{content:c(()=>[g(x,null,{title:c(()=>[Ds]),default:c(()=>[H(r("input",{class:"text-input","onUpdate:modelValue":P[0]||(P[0]=N=>u(a).title=N)},null,512),[[j,u(a).title]])]),_:1}),g(x,null,{title:c(()=>[Is]),default:c(()=>[H(r("input",{class:"text-input","onUpdate:modelValue":P[1]||(P[1]=N=>u(a).description=N)},null,512),[[j,u(a).description]])]),_:1}),g(x,null,{default:c(()=>[H(r("textarea",{class:"text-input textarea","onUpdate:modelValue":P[2]||(P[2]=N=>u(a).content=N),rows:"15"},null,512),[[j,u(a).content]])]),_:1}),g(x,null,{title:c(()=>[xs]),default:c(()=>[r("div",bs,[(i(!0),d(b,null,R(u(f),N=>(i(),$(oe,{active:k(N._id),onClick:Xn=>u(I)(N._id)},{default:c(()=>[w(v(N.title),1)]),_:2},1032,["active","onClick"]))),256))])]),_:1}),g(x,null,{title:c(()=>[Ts]),default:c(()=>[r("div",Bs,[g(be,{change:F,multiple:!1}),g(L,{class:"upload-btn",onClick:h},{default:c(()=>[Ps]),_:1}),r("img",{class:"preview",src:u(m).blob},null,8,As)]),C.value?H((i(),d("textarea",{key:0,class:"copy-container text-input","onUpdate:modelValue":P[3]||(P[3]=N=>C.value=N),readonly:"",onClick:U,rows:"3"},null,512)),[[j,C.value]]):O("",!0),u(o).length>0?(i(),$(Te,{key:1,images:u(o),onClick:y,class:"gallery"},null,8,["images"])):O("",!0)]),_:1}),g(x,{class:"actions"},{default:c(()=>[g(L,{onClick:S},{default:c(()=>[Os]),_:1}),g(oe,{onClick:p,active:u(a).status===1},{default:c(()=>[w(v(u(a).status===1?"\u5DF2\u516C\u5F00":"\u5DF2\u9690\u85CF"),1)]),_:1},8,["active"]),g(L,{onClick:E},{default:c(()=>[Ls]),_:1})]),_:1})]),_:1}))}});var Us=B(Rs,[["__scopeId","data-v-2fcc3554"]]);const Ms=e=>{const t=new Date;let s=new Proxy({source:e,text:e,finished:!1,index:0,res:[]},{set:function(l,a,o,_){return a==="index"?(o>=Reflect.get(l,"source").length&&Reflect.set(l,"finished",!0),Reflect.set(l,"index",o)):Reflect.set(l,a,o)}}),n=0;for(;!s.finished&&n<2e3;)js(s)||Hs(s)||(s.text.startsWith("```\n")?Vs(s):Ns(s)),n++;return console.log(`parse time: ${new Date().getTime()-t.getTime()}ms`),s.res.join("")},de=e=>{let t=e.text,s=t.indexOf(`
`),n=s>=0;s=n?s:t.length;const l=n?s+1:s;let a=t.slice(0,s);return a=a.replaceAll(/(?:<img\s.+?>)|(?:[.+](.+?))/g,o=>{const _=o.match(/description="(.+)"/);if(_){const f=`<span class="image-description">${_[1]}</span>`;return o+f}return o}),{content:a,next:l}},Ns=e=>{let t=e.text;const{content:s,next:n}=de(e);e.res.push(`<p>${s}</p>`),e.text=t.slice(n),e.index+=n},Vs=e=>{let t=e.text,s=4;for(;s<t.length&&!(t[s]==="`"&&t.slice(s,s+3)==="```");)s++;const n=t.slice(4,s);e.res.push(`<code>${n}</code>`);const l=t.slice(s+3,s+4)===`
`?s+4:s+3;e.text=t.slice(l),e.index+=l},Hs=e=>{let t=e.text,s=t.match(/^#+\s/);if(s==null?void 0:s.length){const n=s[0].length;e.text=t.slice(n),e.index+=n;const{content:l,next:a}=de(e),o=`<div class="h${s[0].length-1}">${l}</div>`;return e.res.push(o),e.text=t.slice(n+a),e.index+=a,!0}return!1},js=e=>{let t=e.text,s=t.match(/^\s*-\s/);if(s==null?void 0:s.length){const n=s[0].length;e.text=t.slice(n),e.index+=n;const{content:l,next:a}=de(e),o=`<div class="ul${s[0].length-1}">${l}</div>`;return e.res.push(o),e.text=t.slice(n+a),e.index+=a,!0}return!1},Be=K("detail",{state:()=>({post:{}}),actions:{async init(e){const t=W();this.post=await t.fetchPostById(e),this.post.content=Ms(this.post.content)},clear(){this.post={}}}});const Ks={},ie=e=>(J("data-v-2ab21618"),e=e(),z(),e),Ws=ie(()=>r("div",{class:"title"},null,-1)),Gs=ie(()=>r("div",{class:"long"},null,-1)),Js=ie(()=>r("div",{class:"long"},null,-1)),zs=ie(()=>r("div",{class:"short"},null,-1));function Ys(e,t){return i(),d(b,null,[Ws,Gs,Js,zs],64)}var fe=B(Ks,[["render",Ys],["__scopeId","data-v-2ab21618"]]);const Qs={key:1,class:"meta"},qs={class:"title"},Xs={class:"author"},Zs={class:"time"},en={class:"categories"},tn={key:1},sn={key:0,class:"description"},nn=["innerHTML"],on=T({setup(e){const[t,s]=[Be(),te()],{post:n}=M(t);return Ke(()=>(t.clear(),!0)),(l,a)=>(i(),$(V,null,{content:c(()=>[g(x,null,{default:c(()=>{var o;return[u(n)?(i(),d("div",Qs,[r("div",qs,v(u(n).title),1),r("div",Xs,"by "+v(((o=u(n).author)==null?void 0:o.username)||""),1),r("div",Zs,v(u(q)(u(n).updated_time)),1),r("div",en,v(u(s).mapCategoryName(u(n).category||[]).join(" / ")),1)])):(i(),$(fe,{key:0}))]}),_:1}),g(x,{class:"main"},{default:c(()=>[u(n)?(i(),d("div",tn,[u(n).description?(i(),d("div",sn,v(u(n).description),1)):O("",!0),r("div",{class:"content",innerHTML:u(n).content},null,8,nn)])):(i(),$(fe,{key:0}))]),_:1})]),_:1}))}});var an=B(on,[["__scopeId","data-v-d2a40b68"]]);const rn={class:"actions"},ln=w("\u63D0\u4EA4"),un=w("\u53D6\u6D88"),cn=w("\u5220\u9664"),dn={class:"description"},_n=w("\u7F16\u8F91"),pn=T({setup(e){const[t]=[te()],{categories:s,editing:n}=M(t);t.init();const l=async({remove:a=!1})=>{a?await t.delete():n.value._id?await t.update():await t.add(),t.fetchCategories()};return(a,o)=>(i(),$(V,null,{content:c(()=>[g(x,{class:"edit-wrapper"},{default:c(()=>[H(r("input",{class:"text-input","onUpdate:modelValue":o[0]||(o[0]=_=>u(n).title=_)},null,512),[[j,u(n).title]]),H(r("input",{class:"text-input","onUpdate:modelValue":o[1]||(o[1]=_=>u(n).description=_)},null,512),[[j,u(n).description]]),r("div",rn,[g(L,{type:"primary",onClick:o[2]||(o[2]=_=>l({}))},{default:c(()=>[ln]),_:1}),u(n).title||u(n).description?(i(),$(L,{key:0,onClick:o[3]||(o[3]=_=>u(t).clear())},{default:c(()=>[un]),_:1})):O("",!0),g(L,{class:"right",onClick:o[4]||(o[4]=_=>l({remove:!0}))},{default:c(()=>[cn]),_:1})])]),_:1}),(i(!0),d(b,null,R(u(s),_=>(i(),$(x,{class:"category"},{default:c(()=>[r("span",null,v(_.title),1),r("span",dn,v(_.description),1),g(L,{class:"right",onClick:f=>u(t).editing=_},{default:c(()=>[_n]),_:2},1032,["onClick"])]),_:2},1024))),256))]),_:1}))}});var gn=B(pn,[["__scopeId","data-v-181606c6"]]);const hn=w("\u6700\u8FD1\u66F4\u65B0"),vn=T({setup(e){return(t,s)=>{const n=$e("router-link");return i(),$(V,null,{content:c(()=>[g(x,null,{default:c(()=>[g(n,{to:"/siteinfo"},{default:c(()=>[hn]),_:1})]),_:1})]),_:1})}}});var Pe=B(vn,[["__scopeId","data-v-7029d54e"]]);const mn=r("div",null,"\u91D1\u989D",-1),fn=r("div",null,"\u7C7B\u578B",-1),yn=r("div",null,"\u65E5\u671F",-1),$n=r("div",null,"\u5907\u6CE8",-1),wn=T({setup(e){return(t,s)=>(i(),$(V,null,{content:c(()=>[g(x,null,{default:c(()=>[mn,fn,yn,$n]),_:1})]),_:1}))}});const Cn=e=>(J("data-v-17428602"),e=e(),z(),e),Fn=Cn(()=>r("div",{class:"title"},"Commits",-1)),kn={class:"commit"},Sn={class:"version"},En={class:"title"},Dn={class:"message"},In={class:"date"},xn=T({setup(e){const t=G(!1),s=Ce([]);return(async()=>{t.value=!0,(await A("https://api.github.com/repos/EasonApolo/forvera/commits?per_page=5","GET",null,{withCredentials:!1})).map(a=>{let{committer:{date:o},message:_}=a.commit;o=q(o);let[f,k]=_.split(`

`),I;f=f.replace(/(\d\.\d\.\d)\s*/,(S,E)=>(I=E,"")),k&&(k=k.split(`
`)),s.push({date:o,version:I,title:f,content:k})}),t.value=!1})(),(l,a)=>(i(),$(V,null,{content:c(()=>[g(x,{class:"commits"},{default:c(()=>[Fn,t.value?(i(),$(Fe,{key:0})):O("",!0),(i(!0),d(b,null,R(u(s),o=>(i(),d("div",kn,[r("div",Sn,v(o.version),1),r("div",En,v(o.title),1),r("div",Dn,[r("div",null,[(i(!0),d(b,null,R(o.content,_=>(i(),d("div",null,v(_),1))),256))])]),r("div",In,v(o.date),1)]))),256))]),_:1})]),_:1}))}});var bn=B(xn,[["__scopeId","data-v-17428602"]]);const Tn=e=>(J("data-v-445f6314"),e=e(),z(),e),Bn=Tn(()=>r("span",null,"\u6807\u7B7E",-1)),Pn={class:"categories"},An={class:"group-name"},On={class:"left"},Ln={class:"right"},Rn={class:"date"},Un={key:0,class:"post-cat"},Mn=T({setup(e){const[t,s,n]=[X(),W(),te()];s.fetchPosts();const{posts:l}=M(s);n.init();const{categories:a}=M(n),o=re(()=>{const S=Date.now(),E=3600*24*30*1e3;let p={};const m=[];return k.value.map(F=>{const h=new Date(F.updated_time);if(S-h.getTime()<E)p.name?p.posts.push(F):(p={name:"Recent",posts:[F]},m.push(p));else{const y=`${h.getFullYear()}`;p.name!==y?(p={name:y,posts:[F]},m.push(p)):p.posts.push(F)}}),m});let _=G("");const f=S=>{_.value===S._id?_.value="":_.value=S._id},k=re(()=>_.value?l.value.filter(S=>S.category.includes(_.value)):l.value),I=S=>{Be().init(S),t.go("post")};return(S,E)=>(i(),$(V,null,{content:c(()=>[g(x,{class:"categories-wrapper"},{default:c(()=>[Bn,r("div",Pn,[(i(!0),d(b,null,R(u(a),p=>(i(),$(oe,{active:u(_)===p._id,onClick:m=>f(p)},{default:c(()=>[w(v(p.title),1)]),_:2},1032,["active","onClick"]))),256))])]),_:1}),(i(!0),d(b,null,R(u(o),p=>(i(),d("div",{key:p.name,class:"post-group"},[r("div",An,v(p.name),1),(i(!0),d(b,null,R(p.posts,m=>(i(),$(x,{class:"post",onClick:F=>I(m._id)},{default:c(()=>[r("div",On,v(m.title||"\u65E0\u6807\u9898"),1),r("div",Ln,[r("div",Rn,v(u(q)(m.updated_time)),1),u(a)?(i(),d("div",Un,[(i(!0),d(b,null,R(m.category,F=>{var h;return i(),d("div",null,v((h=u(a).find(y=>y._id===F))==null?void 0:h.title),1)}),256))])):O("",!0)])]),_:2},1032,["onClick"]))),256))]))),128))]),_:1}))}});var Nn=B(Mn,[["__scopeId","data-v-445f6314"]]);const _e=e=>(J("data-v-1c4e7256"),e=e(),z(),e),Vn={class:"nav"},Hn=["onClick"],jn={key:0,class:"message"},Kn=_e(()=>r("div",{class:"message-text",key:"text"},"\u53D1\u8A00",-1)),Wn={key:1,class:"playground"},Gn=_e(()=>r("div",null,"play",-1)),Jn=_e(()=>r("div",null,"ground",-1)),zn=[Gn,Jn],Yn=T({setup(e){const t=ce(),s=X();let n;const l=[{name:"\u6587\u5B57",component:Nn},{name:"\u53D1\u8A00",component:xe},{name:"playground",component:Pe},{name:"\u4E2A\u4EBA",component:Ie}],a=I=>{n=I},o=G(0),_=I=>{o.value=I.activeIndex},f=I=>{n.slideTo(I)},k=()=>{t.reply(),s.router.push("addMessage")};return(I,S)=>(i(),d(b,null,[g(u(We),{"slides-per-view":1,"space-between":50,onSwiper:a,onSlideChange:_},{default:c(()=>[(i(),d(b,null,R(l,E=>g(u(Ge),null,{default:c(()=>[(i(),$(we(E.component)))]),_:2},1024)),64))]),_:1}),r("div",Vn,[(i(),d(b,null,R(l,(E,p)=>r("div",{class:Z(["nav-item",{active:o.value===p}]),onClick:m=>f(p)},[p===1?(i(),d("div",jn,[r("div",{class:Z({"move-up":o.value===p})},[Kn,r("div",{class:"message-icon",key:"icon",onClick:k})],2)])):p===2?(i(),d("div",Wn,zn)):(i(),d(b,{key:2},[w(v(E.name),1)],64))],10,Hn)),64))])],64))}});var Qn=B(Yn,[["__scopeId","data-v-1c4e7256"]]);const qn={history:Je(),routes:[{path:"/",component:Qn},{path:"/message",component:xe},{path:"/profile",component:Ie},{path:"/addMessage",component:Es},{path:"/write",component:Us},{path:"/post",component:an},{path:"/category",component:gn},{path:"/playground",component:Pe},{path:"/balance",component:wn},{path:"/siteinfo",component:bn}]},pe=ze(vt);pe.use(Ye(qn));pe.use(Qe());pe.mount("#app");
