(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["art"],{3846:function(t,e,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},"3c17":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"art"},[t.artData.title?n("div",{staticClass:"article",on:{click:function(e){t.rightToggle=!1}}},[n("div",{staticClass:"title"},[t._v(t._s(t.artData.title.rendered))]),n("div",{staticClass:"time"},[t._v(t._s(t.slicedDate(t.artData.date)))]),n("div",{staticClass:"content",domProps:{innerHTML:t._s(t.artData.content.rendered)}})]):t._e(),n("Loading",{attrs:{intSwitch:t.switch1}}),n("div",{attrs:{id:"comment-header"}},[t._v("> 评论 { "+t._s(t.commentsData.length)+" }")]),t.commentsLoadOK?n("div",{staticClass:"comment-wrapper"},t._l(t.commentsData,function(e,o){return n("div",{key:e.id,staticClass:"comment"},[n("span",{staticClass:"name"},[t._v(t._s(e.author_name))]),0!==e.parent?n("span",{staticClass:"replyto"},[t._v("  --\x3e  "+t._s(t.replyToName(e.toIndex)))]):t._e(),n("span",{staticClass:"content"},[t._v(": "+t._s(e.content.rendered.replace(/<[^>]*>/g,"")))]),n("span",{staticClass:"reply",on:{click:function(e){t.commentToIndex=o}}},[t._v("回复")]),n("span",{staticClass:"time"},[t._v(t._s(t.slicedDate(e.date)))])])}),0):t._e(),n("Loading",{attrs:{intSwitch:t.switch2}}),n("ul",{staticClass:"add",on:{click:function(e){t.rightToggle=!1}}},[n("li",[t._v("> 添加评论"),n("span",{directives:[{name:"show",rawName:"v-show",value:-1!==t.commentToIndex,expression:"commentToIndex !== -1"}],staticClass:"addTo"},[t._v("\n        对  "),n("i",[t._v(" "+t._s(t.commentToName)+" ")]),n("span",{attrs:{id:"removeAddTo"},on:{click:function(e){t.commentToIndex=-1}}},[t._v("取消")])])]),n("li",[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.addContent,expression:"addContent"}],attrs:{name:"content",rows:"2",placeholder:"评论"},domProps:{value:t.addContent},on:{input:function(e){e.target.composing||(t.addContent=e.target.value)}}})]),n("li",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.addName,expression:"addName"}],attrs:{name:"name",placeholder:"名字"},domProps:{value:t.addName},on:{input:function(e){e.target.composing||(t.addName=e.target.value)}}})]),n("li",[n("input",{class:{disabled:t.addSending},attrs:{type:"submit",value:"提交"},on:{click:t.addComment}})])]),n("div",{staticClass:"scrollToTop",class:{scrollToBottom:t.toBottom},on:{click:t.scrollToTop}}),n("div",{staticClass:"right",class:{mini:!t.miniRight},on:{click:function(e){t.rightToggle=!t.rightToggle}}},[t.titles.length>0?n("div",{staticClass:"rbox"},[n("div",{staticClass:"title"},[t._v("目录")]),t._l(t.titles,function(e,o){return n("div",{key:o,staticClass:"item",class:{secondTitle:void 0!=e[1]},on:{click:function(e){t.jumpToTitle(e,o)}}},[void 0==e[1]?n("span",[t._v(t._s(e[0]))]):t._e(),t._v("\n        "+t._s(e[2])+"\n      ")])})],2):t._e()])],1)},a=[],i=(n("a481"),n("6b54"),n("28a5"),n("cadf"),n("551c"),n("f751"),n("097d"),n("f5ef")),s=n("3a5e"),c={name:"art",data:function(){return{postId:0,artData:{},titles:[],commentsData:{},commentsLoadOK:!1,navData:[],switch1:0,switch2:0,scrollY:0,autoScrolling:void 0,commentToIndex:-1,addName:"",addContent:"",addSending:!1,rightToggle:!1}},components:{Loading:s["a"]},computed:{replyToName:function(){var t=this;return function(e){return t.commentsData[e].author_name}},commentToName:function(){var t=this.commentsData[this.commentToIndex];return t?t.author_name:""},slicedDate:function(){return function(t){var e=t.split(/[-T:]/);return e[0]=e[0].slice(2,4),e=e.slice(0,-1),e=e.slice(0,3).join("-")+" "+e.slice(3,5).join(":"),e}},toBottom:function(){return this.scrollY<=800},miniRight:function(){return document.body.clientWidth>750||this.rightToggle}},created:function(){this.postId=this.$route.query.id,this.fetchArticle(),this.fetchComment(),window.addEventListener("scroll",this.scroll)},methods:{scroll:function(){this.scrollY=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop},scrollToTop:function(){var t,e,n=this;if(!this.autoScrolling)if(this.toBottom?(t=this.scrollY,e=document.body.clientHeight-document.documentElement.clientHeight):(t=this.scrollY,e=0),document.body.clientWidth<750)document.documentElement.scrollTop=e;else{var o=0,a=t;this.autoScrolling=setInterval(function(){o=Math.min(1,o+.006),a!=document.documentElement.scrollTop&&n.clearInterval(),document.documentElement.scrollTop=t+(e-t)*(1-Math.pow(o-1,8)),a=document.documentElement.scrollTop,o>=1&&n.clearInterval()},12)}},clearInterval:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){clearInterval(this.autoScrolling),this.autoScrolling=void 0}),addComment:function(){var t=this;if(!this.addSending){if(""!==this.addContent.replace(/\s+/g,"")){this.addSending=!0;var e=new FormData,n=-1==this.commentToIndex?0:this.commentsData[this.commentToIndex].id;return e.append("author_name",this.addName),e.append("content",this.addContent),e.append("parent",n),e.append("post",this.postId),e.append("author_email","787817128@qq.com"),fetch(window.ip+"comments",{method:"POST",body:e}).then(function(){t.addSending=!1,t.addName=t.addContent="",t.commentToIndex=-1,t.fetchComment()}),0}i["a"].$emit("pop","姓名或评论不能为空*A*")}},fetchArticle:function(){var t=this;this.switch1=1,fetch(window.ip+"posts/"+this.postId).then(function(t){return t.json()}).then(function(e){t.artData=e,t.switch1=0,setTimeout(t.getTitles,0)})},getTitles:function(){var t,e=/>([IVX]+\.)([IVX]+)*(.+?(?=<))/g,n=[];while(null!=(t=e.exec(this.artData.content.rendered)))n.push([t[1],t[2],t[3]]);this.titles=n},jumpToTitle:function(t,e){t.stopPropagation();for(var n=this.titles[e].join(""),o=document.getElementsByTagName("p"),a=0;a<o.length;a++)if(o[a].innerText==n){document.documentElement.scrollTop=o[a].offsetTop;break}},fetchComment:function(){var t=this;this.switch2=1,fetch(window.ip+"comments?order=asc&post="+this.postId).then(function(t){return t.json()}).then(function(e){t.commentsData=e;for(var n=t.commentsData.length,o=0;o<n;o++){var a=t.commentsData[o].parent;if(0!==a)for(var i=0;i<o;i++)if(t.commentsData[i].id===a){t.commentsData[o].toIndex=i;break}}t.switch2=0,t.commentsLoadOK=!0})},reload:function(t){var e=this.navData[t].id;-1!==e?(this.$router.push({path:"art",query:{id:e}}),this.postId=this.$route.query.id,this.artData={},this.commentsData={},this.commentsLoadOK=!1,this.navData=[],this.scrollY=0,this.commentToIndex=-1,this.addName="",this.addContent="",this.fetchArticle(),this.fetchComment()):i["a"].$emit("pop",this.navData[t].title)}}},r=c,l=(n("d30a"),n("2877")),d=Object(l["a"])(r,o,a,!1,null,"1d62708d",null);e["default"]=d.exports},"6b54":function(t,e,n){"use strict";n("3846");var o=n("cb7c"),a=n("0bfb"),i=n("9e1e"),s="toString",c=/./[s],r=function(t){n("2aba")(RegExp.prototype,s,t,!0)};n("79e5")(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?r(function(){var t=o(this);return"/".concat(t.source,"/","flags"in t?t.flags:!i&&t instanceof RegExp?a.call(t):void 0)}):c.name!=s&&r(function(){return c.call(this)})},"863e":function(t,e,n){},d30a:function(t,e,n){"use strict";var o=n("863e"),a=n.n(o);a.a}}]);
//# sourceMappingURL=art.de050db0.js.map